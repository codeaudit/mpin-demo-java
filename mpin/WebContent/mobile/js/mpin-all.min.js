/*!
Copyright 2015 CertiVox UK Ltd, All Rights Reserved.

The CertiVox M-Pin Client and Server Libraries are free software: you can
redistribute it and/or modify it under the terms of the BSD 3-Clause
License - http://opensource.org/licenses/BSD-3-Clause

For full details regarding our CertiVox terms of service please refer to
the following links:

  * Our Terms and Conditions -
    http://www.certivox.com/about-certivox/terms-and-conditions/

  * Our Security and Privacy -
    http://www.certivox.com/about-certivox/security-privacy/

  * Our Statement of Position and Our Promise on Software Patents -
    http://www.certivox.com/about-certivox/patents/
*/
;var QRCode;!function(){function O(g){this.mode=M.MODE_8BIT_BYTE,this.data=g,this.parsedData=[];for(var c=[],j=0,i=this.data.length;i>j;j++){var h=this.data.charCodeAt(j);h>65536?(c[0]=240|(1835008&h)>>>18,c[1]=128|(258048&h)>>>12,c[2]=128|(4032&h)>>>6,c[3]=128|63&h):h>2048?(c[0]=224|(61440&h)>>>12,c[1]=128|(4032&h)>>>6,c[2]=128|63&h):h>128?(c[0]=192|(1984&h)>>>6,c[1]=128|63&h):c[0]=h,this.parsedData=this.parsedData.concat(c)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function N(d,c){this.typeNumber=d,this.errorCorrectLevel=c,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function G(f,e){if(void 0==f.length){throw new Error(f.length+"/"+e)}for(var h=0;h<f.length&&0==f[h];){h++}this.num=new Array(f.length-h+e);for(var g=0;g<f.length-h;g++){this.num[g]=f[g+h]}}function F(d,c){this.totalCount=d,this.dataCount=c}function E(){this.buffer=[],this.length=0}function C(){return"undefined"!=typeof CanvasRenderingContext2D}function B(){var d=!1,c=navigator.userAgent;return/android/i.test(c)&&(d=!0,aMat=c.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(d=parseFloat(aMat[1]))),d}function u(i,d){for(var n=1,m=t(i),l=0,k=D.length;k>=l;l++){var j=0;switch(d){case L.L:j=D[l][0];break;case L.M:j=D[l][1];break;case L.Q:j=D[l][2];break;case L.H:j=D[l][3]}if(j>=m){break}n++}if(n>D.length){throw new Error("Too long data")}return n}function t(d){var c=encodeURI(d).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return c.length+(c.length!=d?3:0)}O.prototype={getLength:function(){return this.parsedData.length},write:function(e){for(var d=0,f=this.parsedData.length;f>d;d++){e.put(this.parsedData[d],8)}}},N.prototype={addData:function(a){var d=new O(a);this.dataList.push(d),this.dataCache=null},isDark:function(d,c){if(0>d||this.moduleCount<=d||0>c||this.moduleCount<=c){throw new Error(d+","+c)}return this.modules[d][c]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(b,h){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var g=0;g<this.moduleCount;g++){this.modules[g]=new Array(this.moduleCount);for(var f=0;f<this.moduleCount;f++){this.modules[g][f]=null}}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(b,h),this.typeNumber>=7&&this.setupTypeNumber(b),null==this.dataCache&&(this.dataCache=N.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,h)},setupPositionProbePattern:function(f,e){for(var h=-1;7>=h;h++){if(!(-1>=f+h||this.moduleCount<=f+h)){for(var g=-1;7>=g;g++){-1>=e+g||this.moduleCount<=e+g||(this.modules[f+h][e+g]=h>=0&&6>=h&&(0==g||6==g)||g>=0&&6>=g&&(0==h||6==h)||h>=2&&4>=h&&g>=2&&4>=g?!0:!1)}}}},getBestMaskPattern:function(){for(var f=0,e=0,h=0;8>h;h++){this.makeImpl(!0,h);var g=J.getLostPoint(this);(0==h||f>g)&&(f=g,e=h)}return e},createMovieClip:function(P,s,r){var q=P.createEmptyMovieClip(s,r),p=1;this.make();for(var o=0;o<this.modules.length;o++){for(var n=o*p,m=0;m<this.modules[o].length;m++){var l=m*p,k=this.modules[o][m];k&&(q.beginFill(0,100),q.moveTo(l,n),q.lineTo(l+p,n),q.lineTo(l+p,n+p),q.lineTo(l,n+p),q.endFill())}}return q},setupTimingPattern:function(){for(var d=8;d<this.moduleCount-8;d++){null==this.modules[d][6]&&(this.modules[d][6]=0==d%2)}for(var c=8;c<this.moduleCount-8;c++){null==this.modules[6][c]&&(this.modules[6][c]=0==c%2)}},setupPositionAdjustPattern:function(){for(var i=J.getPatternPosition(this.typeNumber),f=0;f<i.length;f++){for(var n=0;n<i.length;n++){var m=i[f],l=i[n];if(null==this.modules[m][l]){for(var k=-2;2>=k;k++){for(var j=-2;2>=j;j++){this.modules[m+k][l+j]=-2==k||2==k||-2==j||2==j||0==k&&0==j?!0:!1}}}}}},setupTypeNumber:function(f){for(var e=J.getBCHTypeNumber(this.typeNumber),h=0;18>h;h++){var g=!f&&1==(1&e>>h);this.modules[Math.floor(h/3)][h%3+this.moduleCount-8-3]=g}for(var h=0;18>h;h++){var g=!f&&1==(1&e>>h);this.modules[h%3+this.moduleCount-8-3][Math.floor(h/3)]=g}},setupTypeInfo:function(h,f){for(var l=this.errorCorrectLevel<<3|f,k=J.getBCHTypeInfo(l),j=0;15>j;j++){var i=!h&&1==(1&k>>j);6>j?this.modules[j][8]=i:8>j?this.modules[j+1][8]=i:this.modules[this.moduleCount-15+j][8]=i}for(var j=0;15>j;j++){var i=!h&&1==(1&k>>j);8>j?this.modules[8][this.moduleCount-j-1]=i:9>j?this.modules[8][15-j-1+1]=i:this.modules[8][15-j-1]=i}this.modules[this.moduleCount-8][8]=!h},mapData:function(P,s){for(var r=-1,q=this.moduleCount-1,p=7,o=0,n=this.moduleCount-1;n>0;n-=2){for(6==n&&n--;;){for(var m=0;2>m;m++){if(null==this.modules[q][n-m]){var l=!1;o<P.length&&(l=1==(1&P[o]>>>p));var f=J.getMask(s,q,n-m);f&&(l=!l),this.modules[q][n-m]=l,p--,-1==p&&(o++,p=7)}}if(q+=r,0>q||this.moduleCount<=q){q-=r,r=-r;break}}}}},N.PAD0=236,N.PAD1=17,N.createData=function(f,p,o){for(var n=F.getRSBlocks(f,p),m=new E,k=0;k<o.length;k++){var j=o[k];m.put(j.mode,4),m.put(j.getLength(),J.getLengthInBits(j.mode,f)),j.write(m)}for(var b=0,k=0;k<n.length;k++){b+=n[k].dataCount}if(m.getLengthInBits()>8*b){throw new Error("code length overflow. ("+m.getLengthInBits()+">"+8*b+")")}for(m.getLengthInBits()+4<=8*b&&m.put(0,4);0!=m.getLengthInBits()%8;){m.putBit(!1)}for(;;){if(m.getLengthInBits()>=8*b){break}if(m.put(N.PAD0,8),m.getLengthInBits()>=8*b){break}m.put(N.PAD1,8)}return N.createBytes(m,n)},N.createBytes=function(ae,ad){for(var ac=0,ab=0,aa=0,Z=new Array(ad.length),Y=new Array(ad.length),X=0;X<ad.length;X++){var W=ad[X].dataCount,V=ad[X].totalCount-W;ab=Math.max(ab,W),aa=Math.max(aa,V),Z[X]=new Array(W);for(var U=0;U<Z[X].length;U++){Z[X][U]=255&ae.buffer[U+ac]}ac+=W;var T=J.getErrorCorrectPolynomial(V),S=new G(Z[X],T.getLength()-1),R=S.mod(T);Y[X]=new Array(T.getLength()-1);for(var U=0;U<Y[X].length;U++){var Q=U+R.getLength()-Y[X].length;Y[X][U]=Q>=0?R.get(Q):0}}for(var P=0,U=0;U<ad.length;U++){P+=ad[U].totalCount}for(var i=new Array(P),f=0,U=0;ab>U;U++){for(var X=0;X<ad.length;X++){U<Z[X].length&&(i[f++]=Z[X][U])}}for(var U=0;aa>U;U++){for(var X=0;X<ad.length;X++){U<Y[X].length&&(i[f++]=Y[X][U])}}return i};for(var M={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},L={L:1,M:0,Q:3,H:2},K={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},J={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(d){for(var c=d<<10;J.getBCHDigit(c)-J.getBCHDigit(J.G15)>=0;){c^=J.G15<<J.getBCHDigit(c)-J.getBCHDigit(J.G15)}return(d<<10|c)^J.G15_MASK},getBCHTypeNumber:function(d){for(var c=d<<12;J.getBCHDigit(c)-J.getBCHDigit(J.G18)>=0;){c^=J.G18<<J.getBCHDigit(c)-J.getBCHDigit(J.G18)}return d<<12|c},getBCHDigit:function(d){for(var c=0;0!=d;){c++,d>>>=1}return c},getPatternPosition:function(b){return J.PATTERN_POSITION_TABLE[b-1]},getMask:function(e,d,f){switch(e){case K.PATTERN000:return 0==(d+f)%2;case K.PATTERN001:return 0==d%2;case K.PATTERN010:return 0==f%3;case K.PATTERN011:return 0==(d+f)%3;case K.PATTERN100:return 0==(Math.floor(d/2)+Math.floor(f/3))%2;case K.PATTERN101:return 0==d*f%2+d*f%3;case K.PATTERN110:return 0==(d*f%2+d*f%3)%2;case K.PATTERN111:return 0==(d*f%3+(d+f)%2)%2;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var d=new G([1],0),f=0;e>f;f++){d=d.multiply(new G([1,I.gexp(f)],0))}return d},getLengthInBits:function(d,c){if(c>=1&&10>c){switch(d){case M.MODE_NUMBER:return 10;case M.MODE_ALPHA_NUM:return 9;case M.MODE_8BIT_BYTE:return 8;case M.MODE_KANJI:return 8;default:throw new Error("mode:"+d)}}else{if(27>c){switch(d){case M.MODE_NUMBER:return 12;case M.MODE_ALPHA_NUM:return 11;case M.MODE_8BIT_BYTE:return 16;case M.MODE_KANJI:return 10;default:throw new Error("mode:"+d)}}else{if(!(41>c)){throw new Error("type:"+c)}switch(d){case M.MODE_NUMBER:return 14;case M.MODE_ALPHA_NUM:return 13;case M.MODE_8BIT_BYTE:return 16;case M.MODE_KANJI:return 12;default:throw new Error("mode:"+d)}}}},getLostPoint:function(T){for(var S=T.getModuleCount(),R=0,Q=0;S>Q;Q++){for(var P=0;S>P;P++){for(var s=0,r=T.isDark(Q,P),q=-1;1>=q;q++){if(!(0>Q+q||Q+q>=S)){for(var p=-1;1>=p;p++){0>P+p||P+p>=S||(0!=q||0!=p)&&r==T.isDark(Q+q,P+p)&&s++}}}s>5&&(R+=3+s-5)}}for(var Q=0;S-1>Q;Q++){for(var P=0;S-1>P;P++){var o=0;T.isDark(Q,P)&&o++,T.isDark(Q+1,P)&&o++,T.isDark(Q,P+1)&&o++,T.isDark(Q+1,P+1)&&o++,(0==o||4==o)&&(R+=3)}}for(var Q=0;S>Q;Q++){for(var P=0;S-6>P;P++){T.isDark(Q,P)&&!T.isDark(Q,P+1)&&T.isDark(Q,P+2)&&T.isDark(Q,P+3)&&T.isDark(Q,P+4)&&!T.isDark(Q,P+5)&&T.isDark(Q,P+6)&&(R+=40)}}for(var P=0;S>P;P++){for(var Q=0;S-6>Q;Q++){T.isDark(Q,P)&&!T.isDark(Q+1,P)&&T.isDark(Q+2,P)&&T.isDark(Q+3,P)&&T.isDark(Q+4,P)&&!T.isDark(Q+5,P)&&T.isDark(Q+6,P)&&(R+=40)}}for(var n=0,P=0;S>P;P++){for(var Q=0;S>Q;Q++){T.isDark(Q,P)&&n++}}var m=Math.abs(100*n/S/S-50)/5;return R+=10*m}},I={glog:function(b){if(1>b){throw new Error("glog("+b+")")}return I.LOG_TABLE[b]},gexp:function(b){for(;0>b;){b+=255}for(;b>=256;){b-=255}return I.EXP_TABLE[b]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},H=0;8>H;H++){I.EXP_TABLE[H]=1<<H}for(var H=8;256>H;H++){I.EXP_TABLE[H]=I.EXP_TABLE[H-4]^I.EXP_TABLE[H-5]^I.EXP_TABLE[H-6]^I.EXP_TABLE[H-8]}for(var H=0;255>H;H++){I.LOG_TABLE[I.EXP_TABLE[H]]=H}G.prototype={get:function(b){return this.num[b]},getLength:function(){return this.num.length},multiply:function(f){for(var e=new Array(this.getLength()+f.getLength()-1),h=0;h<this.getLength();h++){for(var g=0;g<f.getLength();g++){e[h+g]^=I.gexp(I.glog(this.get(h))+I.glog(f.get(g)))}}return new G(e,0)},mod:function(f){if(this.getLength()-f.getLength()<0){return this}for(var e=I.glog(this.get(0))-I.glog(f.get(0)),h=new Array(this.getLength()),g=0;g<this.getLength();g++){h[g]=this.get(g)}for(var g=0;g<f.getLength();g++){h[g]^=I.gexp(I.glog(f.get(g))+e)}return new G(h,0).mod(f)}},F.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],F.getRSBlocks=function(P,s){var r=F.getRsBlockTable(P,s);if(void 0==r){throw new Error("bad rs block @ typeNumber:"+P+"/errorCorrectLevel:"+s)}for(var q=r.length/3,p=[],o=0;q>o;o++){for(var n=r[3*o+0],m=r[3*o+1],l=r[3*o+2],j=0;n>j;j++){p.push(new F(m,l))}}return p},F.getRsBlockTable=function(d,c){switch(c){case L.L:return F.RS_BLOCK_TABLE[4*(d-1)+0];case L.M:return F.RS_BLOCK_TABLE[4*(d-1)+1];case L.Q:return F.RS_BLOCK_TABLE[4*(d-1)+2];case L.H:return F.RS_BLOCK_TABLE[4*(d-1)+3];default:return void 0}},E.prototype={get:function(d){var c=Math.floor(d/8);return 1==(1&this.buffer[c]>>>7-d%8)},put:function(e,d){for(var f=0;d>f;f++){this.putBit(1==(1&e>>>d-f-1))}},getLengthInBits:function(){return this.length},putBit:function(d){var c=Math.floor(this.length/8);this.buffer.length<=c&&this.buffer.push(0),d&&(this.buffer[c]|=128>>>this.length%8),this.length++}};var D=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],A=function(){var b=function(d,c){this._el=d,this._htOption=c};return b.prototype.draw=function(r){function n(h,g){var j=document.createElementNS("http://www.w3.org/2000/svg",h);for(var i in g){g.hasOwnProperty(i)&&j.setAttribute(i,g[i])}return j}var q=this._htOption,p=this._el,o=r.getModuleCount();Math.floor(q.width/o),Math.floor(q.height/o),this.clear();var m=n("svg",{viewBox:"0 0 "+String(o)+" "+String(o),width:"100%",height:"100%",fill:q.colorLight});m.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),p.appendChild(m),m.appendChild(n("rect",{fill:q.colorDark,width:"1",height:"1",id:"template"}));for(var l=0;o>l;l++){for(var f=0;o>f;f++){if(r.isDark(l,f)){var e=n("use",{x:String(l),y:String(f)});e.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),m.appendChild(e)}}}},b.prototype.clear=function(){for(;this._el.hasChildNodes();){this._el.removeChild(this._el.lastChild)}},b}(),w="svg"===document.documentElement.tagName.toLowerCase(),v=w?A:C()?function(){function g(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function i(l,k){var p=this;if(p._fFail=k,p._fSuccess=l,null===p._bSupportDataURI){var o=document.createElement("img"),n=function(){p._bSupportDataURI=!1,p._fFail&&_fFail.call(p)},m=function(){p._bSupportDataURI=!0,p._fSuccess&&p._fSuccess.call(p)};return o.onabort=n,o.onerror=n,o.onload=m,o.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}p._bSupportDataURI===!0&&p._fSuccess?p._fSuccess.call(p):p._bSupportDataURI===!1&&p._fFail&&p._fFail.call(p)}if(this._android&&this._android<=2.1){var f=1/window.devicePixelRatio,j=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(r,q,p,o,n,m,k,c){if("nodeName" in r&&/img/i.test(r.nodeName)){for(var b=arguments.length-1;b>=1;b--){arguments[b]=arguments[b]*f}}else{"undefined"==typeof c&&(arguments[1]*=f,arguments[2]*=f,arguments[3]*=f,arguments[4]*=f)}j.apply(this,arguments)}}var h=function(d,c){this._bIsPainted=!1,this._android=B(),this._htOption=c,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=c.width,this._elCanvas.height=c.height,d.appendChild(this._elCanvas),this._el=d,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return h.prototype.draw=function(X){var W=this._elImage,V=this._oContext,U=this._htOption,T=X.getModuleCount(),S=U.width/T,R=U.height/T,Q=Math.round(S),P=Math.round(R);W.style.display="none",this.clear();for(var s=0;T>s;s++){for(var r=0;T>r;r++){var q=X.isDark(s,r),p=r*S,o=s*R;V.strokeStyle=q?U.colorDark:U.colorLight,V.lineWidth=1,V.fillStyle=q?U.colorDark:U.colorLight,V.fillRect(p,o,S,R),V.strokeRect(Math.floor(p)+0.5,Math.floor(o)+0.5,Q,P),V.strokeRect(Math.ceil(p)-0.5,Math.ceil(o)-0.5,Q,P)}}this._bIsPainted=!0},h.prototype.makeImage=function(){this._bIsPainted&&i.call(this,g)},h.prototype.isPainted=function(){return this._bIsPainted},h.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},h.prototype.round=function(b){return b?Math.floor(1000*b)/1000:b},h}():function(){var b=function(d,c){this._el=d,this._htOption=c};return b.prototype.draw=function(T){for(var S=this._htOption,R=this._el,Q=T.getModuleCount(),P=Math.floor(S.width/Q),s=Math.floor(S.height/Q),r=['<table style="border:0;border-collapse:collapse;">'],q=0;Q>q;q++){r.push("<tr>");for(var p=0;Q>p;p++){r.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+P+"px;height:"+s+"px;background-color:"+(T.isDark(q,p)?S.colorDark:S.colorLight)+';"></td>')}r.push("</tr>")}r.push("</table>"),R.innerHTML=r.join("");var o=R.childNodes[0],n=(S.width-o.offsetWidth)/2,m=(S.height-o.offsetHeight)/2;n>0&&m>0&&(o.style.margin=m+"px "+n+"px")},b.prototype.clear=function(){this._el.innerHTML=""},b}();QRCode=function(e,d){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:L.H},"string"==typeof d&&(d={text:d}),d){for(var f in d){this._htOption[f]=d[f]}}"string"==typeof e&&(e=document.getElementById(e)),this._android=B(),this._el=e,this._oQRCode=null,this._oDrawing=new v(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(b){this._oQRCode=new N(u(b,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(b),this._oQRCode.make(),this._el.title=b,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=L}();if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());bn=function(a){this.initWith(a)};bn.prototype={radix:24,maxMul:8,_class:bn,_b64codes:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",copy:function(){return new this._class(this)},initWith:function(d){var c=0,b,f,a;var e=false;switch(typeof d){case"object":this.limbs=d.limbs.slice(0);break;case"number":this.limbs=[d];this.normalize();break;case"string":d=d.replace(/^0x/,"");if(d.charAt(0)=="-"){e=true;d=d.slice(1)}this.limbs=[];b=this.radix/4;for(c=0;c<d.length;c+=b){this.limbs.push(parseInt(d.substring(Math.max(d.length-c-b,0),d.length-c),16))}break;default:this.limbs=[0]}if(e){for(c=0;c<this.limbs.length;c++){this.limbs[c]=-this.limbs[c]}this.normalize()}return this},equals:function(b){if(typeof b==="number"){b=new this._class(b)}this.fix();b.fix();var c=0,a;for(a=0;a<this.limbs.length||a<b.limbs.length;a++){c|=this.getLimb(a)^b.getLimb(a)}return(c===0)},getLimb:function(a){return(a>=this.limbs.length)?0:this.limbs[a]},greaterEquals:function(g){if(typeof g==="number"){g=new this._class(g)}var e=0,h=0,f,d,c;f=Math.max(this.limbs.length,g.limbs.length)-1;for(;f>=0;f--){d=this.getLimb(f);c=g.getLimb(f);h|=(c-d)&~e;e|=(d-c)&~h}return(h|~e)>>>31},toString:function(){var d=this.print();var b="",c,e,a=d.limbs;for(c=0;c<d.limbs.length;c++){e=a[c].toString(16);while(c<d.limbs.length-1&&e.length<6){e="0"+e}b=e+b}if(b.length%2==1){b="0x0"+b}else{b="0x"+b}var f=util.hexToBits(b);return util.bitsToString(f)},toHexString:function(){var d=this.print();var b="",c,e,a=d.limbs;for(c=0;c<d.limbs.length;c++){e=a[c].toString(16);while(c<d.limbs.length-1&&e.length<6){e="0"+e}b=e+b}return"0x"+b},toBytes:function(){var a=this.toString();var b=util.stringToBits(a);return util.bitsToBytes(b).reverse()},toMyPaddedBytes:function(a){var b=this.toBytes();while(b.length<a){b.push(0)}while(b.length>a){b.pop()}return b.reverse()},toPaddedBytes:function(a){var b=this.toBytes();var c=a.toBytes();while(b.length<c.length){b.push(0)}return b.reverse()},toTruncatedBytes:function(){var a=this.toBytes();while(a[a.length-1]==0){a.pop()}return a},addM:function(c){if(typeof(c)!=="object"){c=new this._class(c)}var b,a=this.limbs,d=c.limbs;for(b=a.length;b<d.length;b++){a[b]=0}for(b=0;b<d.length;b++){a[b]+=d[b]}return this},pmulM:function(c){var b,a=this.limbs;for(b=0;b<a.length;b++){a[b]*=c}return this.normalize()},doubleM:function(){var d,f=0,c,e=this.radix,a=this.radixMask,b=this.limbs;for(d=0;d<b.length;d++){c=b[d];c=c+c+f;b[d]=c&a;f=c>>e}if(f){b.push(f)}return this},halveM:function(){var c,e=0,b,d=this.radix,a=this.limbs;for(c=a.length-1;c>=0;c--){b=a[c];a[c]=(b+e)>>1;e=(b&1)<<d}if(!a[a.length-1]){a.pop()}return this},subM:function(c){if(typeof(c)!=="object"){c=new this._class(c)}var b,a=this.limbs,d=c.limbs;for(b=a.length;b<d.length;b++){a[b]=0}for(b=0;b<d.length;b++){a[b]-=d[b]}return this},mulM:function(k){if(typeof(k)==="number"){k=new this._class(k)}this.cnormalize();k.cnormalize();var g,e,o=this.limbs,n=k.limbs,h=o.length,d=n.length,f=new this._class(),m=f.limbs,l,p=this.maxMul;for(g=0;g<h+d;g++){m[g]=0}cl=m.length;for(;g<m.length;g++){m[g]=0}for(g=0;g<h;g++){l=o[g];for(e=0;e<d;e++){m[g+e]+=l*n[e]}if(!--p){p=this.maxMul;f.cnormalize()}}return f.cnormalize()},sqrM:function(){this.cnormalize();var f,b,d,l=this.limbs,g=l.length,e=new this._class(),h=e.limbs,k,m=this.maxMul;for(f=0;f<g+g;f++){h[f]=0}cl=h.length;for(;f<h.length;f++){h[f]=0}for(f=0;f<g;f++){k=l[f];for(d=f+1;d<g;d++){h[f+d]+=k*l[d]}if(!--m){m=this.maxMul;e.cnormalize()}}e.cnormalize();for(f=0;f<g+g;f++){h[f]+=h[f]}for(f=0;f<g;f++){b=f+f;h[b]+=l[f]*l[f]}return e.cnormalize()},mod:function(c){c=new bn(c).normalize();var a=new bn(this).normalize(),b=0;for(;a.greaterEquals(c);b++){c.doubleM()}for(;b>0;b--){c.halveM();if(a.greaterEquals(c)){a.subM(c).normalize()}}return a.trim()},div:function(e){e=new bn(e).normalize();var b=new bn(this).normalize(),c=0;var d=new bn(1);var a=new bn(0);for(;b.greaterEquals(e);c++){d.doubleM();e.doubleM()}for(;c>0;c--){e.halveM();d.halveM();if(b.greaterEquals(e)){a.addM(d).normalize();b.subM(e).normalize()}}return a},inverseMod:function(h){var e=new bn(1),d=new bn(0),c=new bn(this),k=new bn(h),g,f,j=1;if(!(h.limbs[0]&1)){throw (new cjct.error("invalid argument"))}do{if(c.limbs[0]&1){if(!c.greaterEquals(k)){g=c;c=k;k=g;g=e;e=d;d=g}c.subM(k);c.normalize();if(!e.greaterEquals(d)){e.addM(h)}e.subM(d)}c.halveM();if(e.limbs[0]&1){e.addM(h)}e.normalize();e.halveM();for(f=j=0;f<c.limbs.length;f++){j|=c.limbs[f]}}while(j);if(!k.equals(1)){throw new cjct.error("invalid arguments")}return d},negative:function(){this.normalize().trim();return(this.limbs[this.limbs.length-1]<0)},neg:function(){return new this._class(0).sub(this)},add:function(a){return this.copy().addM(a)},dbl:function(){return this.copy().doubleM()},hlv:function(){return this.copy().halveM()},sub:function(a){return this.copy().subM(a)},pmul:function(a){return this.copy().pmulM(a)},mul:function(a){return this.mulM(a).reduce()},square:function(){return this.sqrM().reduce()},power:function(a){if(typeof(a)==="number"){a=[a]}else{if(a.limbs!==undefined){a=a.normalize().limbs}}var d,c,b=new this._class(1),e=this;for(d=a.length-1;d>=0;d--){for(c=bn.prototype.radix-1;c>=0;c--){b=b.square();if(a[d]&(1<<c)){b=b.mul(this)}}}return b},recode:function(f,c,e){var d,h,a=bn.prototype.radix;var g=0;for(d=c-1;d>=0;d--){g+=g;h=e+d*f;g+=(this.limbs[Math.floor(h/a)]&(1<<(h%a)))>>(h%a)}return g},glv:function(f,a,g){var e,d,c,b;c=new Array(2);b=new Array(2);for(e=0;e<2;e++){c[e]=new bn(0);b[e]=new bn();if(a[e].negative()){b[e]=this.mul(a[e].neg()).div(f).neg().normalize()}else{b[e]=this.mul(a[e]).div(f)}}c[0]=this;for(e=0;e<2;e++){for(d=0;d<2;d++){c[e]=c[e].sub(b[d].mul(g[d][e]))}c[e].normalize().trim()}return c},gs:function(h,a,k){var e,d,c,b,f;c=new Array(4);b=new Array(4);for(e=0;e<4;e++){c[e]=new bn(0);b[e]=new bn();if(a[e].negative()){b[e]=this.mul(a[e].neg()).div(h).neg().normalize()}else{b[e]=this.mul(a[e]).div(h)}}c[0]=this;for(e=0;e<4;e++){for(d=0;d<4;d++){c[e]=c[e].sub(b[d].mul(k[d][e]))}c[e].normalize().trim()}return c},trim:function(){var a=this.limbs,b;do{b=a.pop()}while(a.length&&b===0);a.push(b);return this},reduce:function(){return this.normalize()},print:function(){return this.normalize()},fix:function(){return this.normalize()},print:function(){return this.normalize()},normalize:function(){var h=0,c,g=this.placeVal,e=this.ipv,b,a,f=this.limbs,d=f.length,j=this.radixMask;for(c=0;c<d||(h!==0&&h!==-1);c++){b=(f[c]||0)+h;a=f[c]=b&j;h=(b-a)*e}if(h===-1){f[c-1]-=this.placeVal}return this},cnormalize:function(){var g=0,e,d=this.ipv,c,a,h=this.limbs,f=h.length,b=this.radixMask;for(e=0;e<f-1;e++){c=h[e]+g;a=h[e]=c&b;g=(c-a)*d}h[e]+=g;return this}};bn.fromBits=function(g){var c=this,d=new c(),i=[],b=bitArray,f=this.prototype,a=Math.min(this.bitLength||4294967296,b.bitLength(g)),h=a%f.radix||f.radix;i[0]=b.extract(g,0,h);for(;h<a;h+=f.radix){i.unshift(b.extract(g,h,f.radix))}d.limbs=i;return d};bn.prototype.ipv=1/(bn.prototype.placeVal=Math.pow(2,bn.prototype.radix));bn.prototype.radixMask=(1<<bn.prototype.radix)-1;bn.sparsePrime=function(f,b){function g(h){this.initWith(h);this.fix()}var a=g.prototype=new bn(),d,c,e;e=a.modOffset=Math.ceil(c=f/a.radix);a.exponent=f;a.offset=[];a.factor=[];a.minOffset=e;a.fullMask=0;a.fullOffset=[];a.fullFactor=[];a.modulus=g.modulus=new bn(Math.pow(2,f));a.fullMask=0|-Math.pow(2,f%a.radix);for(d=0;d<b.length;d++){a.offset[d]=Math.floor(b[d][0]/a.radix-c);a.fullOffset[d]=Math.ceil(b[d][0]/a.radix-c);a.factor[d]=b[d][1]*Math.pow(1/2,f-b[d][0]+a.offset[d]*a.radix);a.fullFactor[d]=b[d][1]*Math.pow(1/2,f-b[d][0]+a.fullOffset[d]*a.radix);a.modulus.addM(new bn(Math.pow(2,b[d][0])*b[d][1]));a.minOffset=Math.min(a.minOffset,-a.offset[d])}a._class=g;a.modulus.cnormalize();a.reduce=function(){var q,p,o,n=this.modOffset,t=this.limbs,j,m=this.offset,r=this.offset.length,h=this.factor,s;q=this.minOffset;while(t.length>n){o=t.pop();s=t.length;for(p=0;p<r;p++){t[s+m[p]]-=h[p]*o}q--;if(!q){t.push(0);this.cnormalize();q=this.minOffset}}this.cnormalize();return this};a._strongReduce=(a.fullMask===-1)?a.reduce:function(){var n=this.limbs,m=n.length-1,j,h;this.reduce();if(m===this.modOffset-1){h=n[m]&this.fullMask;n[m]-=h;for(j=0;j<this.fullOffset.length;j++){n[m+this.fullOffset[j]]-=this.fullFactor[j]*h}this.normalize()}};a.fix=function(){var j,h;this._strongReduce();this.addM(this.modulus);this.addM(this.modulus);this.normalize();this._strongReduce();for(h=this.limbs.length;h<this.modOffset;h++){this.limbs[h]=0}j=this.greaterEquals(this.modulus);for(h=0;h<this.limbs.length;h++){this.limbs[h]-=this.modulus.limbs[h]*j}this.cnormalize();return this};a.print=function(){return this.fix()};a.inverse=function(){return this.inverseMod(this.modulus)};a.sqrt=function(){return this.power(this.modulus.add(1).hlv().hlv())};g.fromBits=bn.fromBits;return g};bn.densePrime=function(b,d){function c(h){var e=new bn(b),j=e.limbs.length;var g=new bn(h);if(typeof h=="number"&&h!==0||typeof h=="string"){g.limbs=(new Array(j)).concat(g.limbs);for(var f=0;f<j;f++){g.limbs[f]=0}g=g.mod(e)}while(!g.greaterEquals(0)){g.addM(e)}while(g.greaterEquals(e)){g.subM(e)}g.cnormalize();this.limbs=g.limbs.slice(0)}var a=c.prototype=new bn();a.modulus=c.modulus=new bn(b);a.digit=c.digit=(new bn(d)).limbs[0];a._class=c;a.modulus.cnormalize();a.reduce=function(){this.cnormalize();var u=this.limbs,h=this.modulus.limbs,g=h.length;var o,k,s,v=bn.prototype.radixMask;var p=bn.prototype.ipv;var f=bn.prototype.maxMul-2;var q=f;for(var n=u.length;n<2*g;n++){u[n]=0}for(var n=0;n<g;n++){var e=((u[n]&v)*this.digit)&v;for(var l=0;l<g;l++){u[n+l]+=h[l]*e}q--;if(!q){this.normalize();q=f}else{o=u[n];k=u[n]=o&v;s=(o-k)*p;u[n+1]+=s}}this.normalize();this.limbs=new Array(g);for(var n=0;n<g;n++){this.limbs[n]=0}for(var n=0;n<(u.length-g);n++){this.limbs[n]=u[n+g]}while(this.greaterEquals(this.modulus)){this.subM(this.modulus);this.cnormalize()}return this.copy()};a.fix=function(){while(!this.greaterEquals(new bn(0))){this.addM(this.modulus)}while(this.greaterEquals(this.modulus)){this.subM(this.modulus)}return this.cnormalize()};a.print=function(){while(this.greaterEquals(this.modulus)){this.subM(this.modulus)}this.normalize().trim();var e=this.copy();var g=this.copy();g.limbs=new Array(2*this.modulus.limbs.length+1);for(var f=0;f<this.limbs.length;f++){g.limbs[f]=this.limbs[f]}for(var f=this.limbs.length;f<g.limbs.length;f++){g.limbs[f]=0}g=g.reduce();for(var f=0;f<this.modulus.limbs.length;f++){e.limbs[f]=g.limbs[f]}return e.trim()};a.inverse=function(){var g=this.copy();g=g.print();g=g.inverseMod(this.modulus).normalize().trim();var e=new bn(this.modulus),h=e.limbs.length;g.limbs=(new Array(h)).concat(g.limbs);for(var f=0;f<h;f++){g.limbs[f]=0}g=g.mod(e);while(!g.greaterEquals(0)){g.addM(e)}while(g.greaterEquals(e)){g.subM(e)}g.normalize();g._class=c;for(var f=g.limbs.length;f<this.modulus.limbs.length;f++){g.limbs[f]=0}return g};a.sqrt=function(){return this.power(this.modulus.add(1).hlv().hlv())};return c};bn.prime={p127:bn.sparsePrime(127,[[0,-1]]),p25519:bn.sparsePrime(255,[[0,-19]]),p192:bn.sparsePrime(192,[[0,-1],[64,-1]]),p224:bn.sparsePrime(224,[[0,1],[96,-1]]),p256:bn.sparsePrime(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:bn.sparsePrime(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:bn.sparsePrime(521,[[0,-1]]),p254:bn.densePrime("0x2400000008702A0DB0BDDF647A6366D3243FD6EE18093EE1BE6623EF5C1B55B3","0x789E85")};bn.random=function(c,f){if(typeof c!=="object"){c=new bn(c)}var g,e,b=c.limbs.length,a=c.limbs[b-1]+1,d=new bn();while(true){do{g=random.randomWords(b,f);if(g[b-1]<0){g[b-1]+=4294967296}}while(Math.floor(g[b-1]/a)===Math.floor(4294967296/a));g[b-1]%=a;for(e=0;e<b-1;e++){g[e]&=c.radixMask}d.limbs=g;if(!d.greaterEquals(c)){return d}}};ecc={};ecc.point=function(c,a,d,b){if(a===undefined){this.isIdentity=true}else{this.x=new c.field(a);this.y=new c.field(d);if(b===undefined){this.z=new c.field(1)}else{this.z=new c.field(b)}this.isIdentity=false}this.curve=c};ecc.point.prototype={precompute:function(){var a,c,b;if(this.multiples===undefined){b=this.dbl();a=this.multiples=[new ecc.point(this.curve),this,b.toAffine()];for(c=3;c<11;c++){b=b.add(this);a.push(b.toAffine())}}},add:function(c){var e=this;if(e.curve!==c.curve){throw new cjct.error("points must be on the same curve to add them!")}if(e.isIdentity){return c}else{if(c.isIdentity){return e}}var h=e.z.square();var d=new e.curve.field(c.x.mul(h).sub(e.x));var g=new e.curve.field(h.mul(e.z).mul(c.y).sub(e.y));if(d.equals(0)){if(g.equals(0)){return e.dbl()}else{return new ecc.point(e.curve)}}var f=d.square();var a=d.mul(f);var b=e.x.mul(f);x=new e.curve.field(g.square().sub(a).sub(b).sub(b));b=new e.curve.field(b.sub(x)).mul(g);y=new e.curve.field(b.sub(e.y.mul(a)));z=e.z.mul(d);return new ecc.point(this.curve,x,y,z)},neg:function(){if(this.isIdentity){return this}return new ecc.point(this.curve,this.x,this.y.neg(),this.z)},sub:function(a){if(this.isIdentity){return a.neg()}return this.add(a.neg())},dbl:function(){if(this.isIdentity){return this}if(this.curve.a.equals(0)){var f=this.x.square();var e=this.y.square();var d=e.square();var c=this.z.square();var b=new this.curve.field(this.x.add(e).square().sub(f).sub(d)).dbl();var a=f.add(f).add(f);var i=new this.curve.field(a.square().sub(b).sub(b));b=new this.curve.field(b.sub(i));var h=new this.curve.field(a.mul(b).sub(d.dbl().dbl().dbl()));var g=this.y.mul(this.z).dbl()}else{var f=this.z.square();var e=this.y.square();var d=this.x.mul(e);var c=new this.curve.field(this.x.sub(f)).mul(this.x.add(f));c=c.dbl().add(c);d=d.dbl().dbl();var i=new this.curve.field(c.square().sub(d.dbl()));var g=new this.curve.field(this.y.add(this.z).square().sub(e).sub(f));var h=new this.curve.field(d.sub(i).mul(c).sub(e.square().dbl().dbl().dbl()))}return new ecc.point(this.curve,i,h,g)},toAffine:function(){if(this.isIdentity||this.z.equals(0)||this.z.undefined){return new ecc.point(this.curve)}if(this.z.equals(1)){return this}var b=this.z.inverse(),a=b.square();return new ecc.point(this.curve,this.x.mul(a),this.y.mul(a.mul(b)))},equals:function(a){var c=this.toAffine();var b=a.toAffine();if(c.isIdentity==true&&b.isIdentity){return true}return c.x.equals(b.x)&&c.y.equals(b.y)},toString:function(){var a=this.toAffine();return"["+a.x.toString()+","+a.y.toString()+"]"},smul:function(a){var d,c,b=new ecc.point(this.curve);if(typeof(a)==="number"){a=[a]}else{if(a.limbs!==undefined){a=a.normalize().limbs}}for(d=a.length-1;d>=0;d--){for(c=bn.prototype.radix-1;c>=0;c--){b=b.dbl();if(a[d]&(1<<c)){b=b.add(this)}}}return b.toAffine()},mul:function(d,p){var h,f,g=new ecc.point(this.curve);if(p===undefined){var c,q,o,a,e;if(typeof(d)==="number"){c=3*d;c=Math.floor(c/2);d=Math.floor(d/2);d=[d];c=[c]}else{if(d.limbs!==undefined){d=d.normalize();c=new bn(d);c=c.pmul(3);d=d.hlv().limbs;c=c.normalize().hlv().limbs}}this.precompute();if(this.multiples===undefined){for(h=c.length-1;h>=0;h--){for(f=bn.prototype.radix-1;f>=0;f--){g=g.dbl();a=(1<<f);q=c[h]&a;o=d[h]&a;if(q>o){g=g.add(this)}if(q<o){g=g.sub(this)}}}}else{for(h=c.length-1;h>=0;h--){for(f=bn.prototype.radix-4;f>=0;f-=4){e=(c[h]>>f&15)-(d[h]>>f&15);g=g.dbl().dbl().dbl().dbl();if(e>0){g=g.add(this.multiples[e])}if(e<0){g=g.sub(this.multiples[-e])}}}}}else{var n=8;var q=32;for(h=q-1;h>=0;h--){f=d.recode(q,n,h);g=g.dbl();if(f>0){if(f==1){g=g.add(this)}else{g=g.add(p[f-2])}}}}return g.toAffine()},mul2:function(e,d,f,r,q){var h=new ecc.point(this.curve);if(r===undefined){var l,g,n,u,p,a;e=e.normalize().limbs;f=f.normalize().limbs;if(e.length>f.length){n=e.length;for(l=f.length;l<n;l++){f[l]=0}}else{n=f.length;for(l=e.length;l<n;l++){e[l]=0}}var c=this.add(d).toAffine();for(l=n-1;l>=0;l--){for(g=bn.prototype.radix-1;g>=0;g--){h=h.dbl();a=(1<<g);u=e[l]&a;p=f[l]&a;if(u){if(p){h=h.add(c)}else{h=h.add(this)}}else{if(p){h=h.add(d)}}}}}else{var o=8;var u=32;var l,v,s;for(l=u-1;l>=0;l--){v=e.recode(u,o,l);s=f.recode(u,o,l);h=h.dbl();if(v>0){if(v==1){h=h.add(this)}else{h=h.add(r[v-2])}}if(s>0){if(s==1){h=h.add(d)}else{h=h.add(q[s-2])}}}}return h.toAffine()},endomorph:function(){this.toAffine();return new ecc.point(this.curve,this.x.mul(ecc.constants.Beta),this.y)},GLVmul:function(f){var c,a,g,b;var d;a=new Array(2);a[0]=ecc.constants.A;a[1]=ecc.constants.B;g=new Array(2);for(c=0;c<2;c++){g[c]=new Array(2)}g[0][0]=ecc.constants.A.copy().add(ecc.constants.B).normalize();g[0][1]=ecc.constants.B;g[1][0]=ecc.constants.B;g[1][1]=ecc.constants.A.copy().neg().normalize();b=f.glv(this.curve.r,a,g);d=this.endomorph();if(b[1].negative()){b[1]=b[1].neg().normalize().trim();d=d.neg()}if(b[0].negative()){b[0]=b[0].neg().normalize().trim();return this.neg().mul2(b[0],d,b[1])}else{return this.mul2(b[0],d,b[1])}},isValid:function(){var c=this.z.square(),b=c.square(),a=b.mul(c);return this.y.square().equals(this.curve.b.mul(a).add(this.x.mul(this.curve.a.mul(b).add(this.x.square()))))}};ecc.point.random=function(c){var a,d;while(true){a=new c.field(new bn.random(c.field.modulus));var b=a.mul(a).mul(a).add(c.b).add(c.a.mul(a));d=b.sqrt();if(d.square().equals(b)){return new ecc.point(c,a,d)}if(d.neg().square().equals(b)){return new ecc.point(c,a,d.neg())}}};ecc.point.fromString=function(b,d){var c=b.indexOf(",");var a=b.substring(1,c);b[c]="/";var e=b.substring(c+1,b.length-1);return new ecc.point(d,util.bitsToHex(util.stringToBits(a)),util.bitsToHex(util.stringToBits(e)))};ecc.curve=function(f,g,e,d,c,h){this.field=f;this.t=new bn(g);this.r=f.prototype.modulus.sub(g);this.a=new f(e);this.b=new f(d);this.G=new ecc.point(this,new f(c),new f(h))};ecc.curves={c192:new ecc.curve(bn.prime.p192,"0x662107c8eb94364e4b2dd7ce",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new ecc.curve(bn.prime.p224,"0xe95c1f470fc1ec22d6baa3a3d5c4",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new ecc.curve(bn.prime.p256,"0x4319055358e8617b0c46353d039cdaae",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new ecc.curve(bn.prime.p384,"0x389cb27e0bc8d21fa7e5f24cb74f58851313e696333ad68c",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),c254:new ecc.curve(bn.prime.p254,"0x600000000B4038130054634925303646",0,2,"0x2400000008702A0DB0BDDF647A6366D3243FD6EE18093EE1BE6623EF5C1B55B2","0x1")};ecc.constants={A:new bn("600000000B40381200546349162FEB83"),B:new bn("8000000007802561"),Beta:new bn("8A2767366FEB39F76D4080940EAFD73531BA5621CB403D1C721FF30A56F323C")};idak={_curve:ecc.curves.c254,FS:32,permits:true,_var:new bn("0x4000000003C012B1"),_neg:true,_hash:function(a){var c=new sha256();for(var b=0;b<a.length;b++){c.update_byte(a[b])}var d=util.wordsToBytes(c.finalize());while(d.length<32){bytes.push(0)}while(d.length>32){bytes.pop()}return d},_hashIt:function(a){var c=new sha256();for(var b=0;b<a.length;b++){c.update_byte(a[b])}return util.bitsToString(util.bytesToBits(util.wordsToBytes(c.finalize())))},_hashToInteger:function(a,c){var e=new sha256();for(var d=0;d<a.length;d++){e.update_byte(a[d])}e=util.wordsToBytes(e.finalize());var b=new bn(util.bitsToHex(util.bytesToBits(e)));return b.mod(c)},_hashToPoint1:function(b){var f=new sha256();for(var d=0;d<b.length;d++){f.update_byte(b[d])}f=util.wordsToBytes(f.finalize());var c=new bn(util.bitsToHex(util.bytesToBits(f)));c=c.mod(this._curve.field.modulus);while(true){var a=new this._curve.field(c.toHexString());var e=a.mul(a).mul(a).add(this._curve.a.mul(a)).add(this._curve.b);var g=e.sqrt();if(g.print().limbs[0]&1){g=g.neg()}if(g.square().equals(e)){return new ecc.point(this._curve,a,g)}c=c.add(new bn(1))}},_getSecret:function(){do{var a=new bn.random(this._curve.r)}while(a.equals(0));return a},getSecret:function(){return this._getSecret()},hashedID:function(a){return this._hashToPoint1(util.unicodeToBytes(a))},hashedTpID:function(a){return this._hashToPoint1(util.wordToBytes(util.today()).concat(util.unicodeToBytes(a)))},computeMPin_1c:function(a,c,e){var d;var b=a.toAffine();d=b.add(c).toAffine();d=d.mul(e).toString();return d},computeMPin_1x:function(a,c){var b=a.toAffine();b=b.mul(c).toString();return b},computeMPin_1b:function(b,a,c,d,g){var e=new ecc.point.fromString(d,this._curve);var c=parseInt(c,10);e=e.add(b.smul(c)).toAffine();if(this.permits){var f=new ecc.point.fromString(g,this._curve);e=e.add(f).toAffine()}e=e.mul(a).toString();return e},computeMPin_2:function(j,h,B,c){var v=B.inverseMod(this._curve.r);var f=j.add(h).mul(v).mod(this._curve.r);var E=util.bitsToBytes(util.stringToBits(c));var d=new Array(12);for(var F=0;F<12;F++){d[F]=E.slice(F*this.FS,(F+1)*this.FS);d[F]=util.bitsToHex(util.bytesToBits(d[F]))}var A=new fp2(d[0],d[1]);var u=new fp2(d[8],d[9]);var s=new fp2(d[6],d[7]);var o=new fp6(A,u,s);var r=new fp2(d[4],d[5]);var q=new fp2(d[2],d[3]);var p=new fp2(d[10],d[11]);var l=new fp6(r,q,p);var G=new fp12(o,l);if(!G.member()){return["0",false]}var b=G.trace();var w=G.copy();w=w.frobenius();var a=w.trace();G=G.conj();w=w.mul(G);var K=w.trace();w=w.mul(G);var J=w.trace();var t=this._curve.field.modulus.sub(this._curve.r).normalize().trim();var C=f.mod(t);var I=f.div(t);var H=b.xtr_pow2(a,K,J,C,I);var E=H.els[0].els[0].toMyPaddedBytes(32).concat(H.els[0].els[1].toMyPaddedBytes(32)).concat(H.els[1].els[0].toMyPaddedBytes(32)).concat(H.els[1].els[1].toMyPaddedBytes(32));var D=this._hash(E).slice(0,16);return[util.bitsToString(util.bytesToBits(D)),true]}};sha256=function(){if(!this.k[0]){this.precompute()}this.initialize()};sha256.prototype={init:[],k:[],precompute:function(){var d=2,c=0,b;function a(e){return(e-Math.floor(e))*4294967296|0}outer:for(;c<64;d++){for(b=2;b*b<=d;b++){if(d%b==0){continue outer}}if(c<8){this.init[c]=a(Math.pow(d,1/2))}this.k[c]=a(Math.pow(d,1/3));c++}},initialize:function(){this.h=this.init.slice(0);this.word_buffer=[];this.bit_buffer=0;this.bits_buffered=0;this.length=0;this.length_upper=0},block:function(p){var u=p.slice(0),e,j=this.h,f,c=this.k;var s=j[0],q=j[1],o=j[2],n=j[3],m=j[4],l=j[5],g=j[6],d=j[7];for(e=0;e<64;e++){if(e<16){f=u[e]}else{var t=u[(e+1)&15],r=u[(e+14)&15];f=u[e&15]=((t>>>7^t>>>18^t>>>3^t<<25^t<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+u[e&15]+u[(e+9)&15])|0}f+=d+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(g^m&(l^g))+c[e];d=g;g=l;l=m;m=n+f|0;n=o;o=q;q=s;s=(f+((q&o)^(n&(q^o)))+(q>>>2^q>>>13^q>>>22^q<<30^q<<19^q<<10))|0}j[0]+=s;j[1]+=q;j[2]+=o;j[3]+=n;j[4]+=m;j[5]+=l;j[6]+=g;j[7]+=d},update_word_big_endian:function(a){var b;if((b=this.bits_buffered)){this.word_buffer.push(a>>>(32-b)^this.bit_buffer);this.bit_buffer=a<<b}else{this.word_buffer.push(a)}this.length+=32;if(this.length==0){this.length_upper++}if(this.word_buffer.length==16){this.block(this.word_buffer);this.word_buffer=[]}},update_word_little_endian:function(a){a=a>>>16^a<<16;a=((a>>>8)&16711935)^((a<<8)&4278255360);this.update_word_big_endian(a)},update_words_big_endian:function(b){for(var a=0;a<b.length;a++){this.update_word_big_endian(b[a])}},update_words_little_endian:function(b){for(var a=0;a<b.length;a++){this.update_word_little_endian(b[a])}},update_byte:function(a){this.bit_buffer^=(a&255)<<(24-(this.bits_buffered));this.bits_buffered+=8;if(this.bits_buffered==32){this.bits_buffered=0;this.update_word_big_endian(this.bit_buffer);this.bit_buffer=0}},update_string:function(a){throw new cjct.error("not yet implemented")},finalize:function(){var a,c=this.word_buffer;c.push(this.bit_buffer^(1<<(31-this.bits_buffered)));for(a=(c.length+2);a&15;a++){c.push(0)}c.push(this.length_upper);c.push(this.length+this.bits_buffered);while(c.length){this.block(c.splice(0,16))}var b=this.h;this.initialize();return b}};sha256.hash_words_big_endian=function(c){var b=new sha256();for(var a=0;a<=c.length-16;a+=16){b.block(c.slice(a,a+16))}b.length=a<<5;if(a<c.length){b.update_words_little_endian(c.slice(a))}return b.finalize()};sha256.hash_words_little_endian=function(c){var a=c.slice(0);for(var b=0;b<a.length;b++){a[b]=a[b]>>>16^a[b]<<16;a[b]=((a[b]>>>8)&16711935)^((a[b]<<8)&4278255360)}return sha256.hash_words_big_endian(a)};util={};util.today=function(){var a=new Date();return Math.floor(a.getTime()/(60000*1440))};util.hex=function(e){var a="",b,c="0123456789ABCDEF";for(b=0;b<8;b++){var d=e&15;a=c.substring(d,d+1)+a;e=e>>>4}return a};util.hexall=function(c){var a="",b;for(b=0;b<c.length;b++){if(b%4==0){a+="<br/>\n"}else{if(b){a+=" "}}a+=util.hex(c[b])}return a};util.unicodeToBytes=function(e){var a=[];for(var c=0;c<e.length;c++){if(e.charCodeAt(c)<=127){a.push(e.charCodeAt(c))}else{var d=encodeURIComponent(e.charAt(c)).substr(1).split("%");for(var b=0;b<d.length;b++){a.push(parseInt(d[b],16))}}}return a};util.bytesToUnicode=function(a){var c="";for(var b=0;b<a.length;b++){c+=a[b]<=127?a[b]===37?"%25":String.fromCharCode(a[b]):"%"+a[b].toString(16).toUpperCase()}return decodeURIComponent(c)};util.wordsToBytes=function(f){var b=255,a=[];for(var e=0;e<f.length;e++){var c=e*4;for(var d=0;d<4;d++){a[c+d]=(f[e]&(b<<(8*(3-d))))>>>(8*(3-d))}}return a};util.wordToBytes=function(d){var b=255,a=[];for(var c=0;c<4;c++){a[c]=(d&(b<<(8*(3-c))))>>>(8*(3-c))}return a};util.bytesToWords=function(b){var a=b.slice(),e=[];while(a.length%4!=0){a.push(0)}var d=Math.floor(a.length/4);for(var c=0;c<d;c++){e[c]=((a[(c<<2)+3])|(a[(c<<2)+2]<<8)|(a[(c<<2)+1]<<16)|(a[c<<2]<<24))}return e};util.fixBytesLen=function(d,c){var a=d.slice(0);while(a.length>c){a.shift()}while(a.length<c){a.unshift(0)}return a};util._chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",util._clamp=function(d,b){if(d.length*32<b){return d}d=d.slice(0,Math.ceil(b/32));var c=d.length;b=b&31;if(c>0&&b){d[c-1]=util._partial(b,d[c-1]&2147483648>>(b-1),1)}return d};util._getPartial=function(a){return Math.round(a/1099511627776)||32},util._bitLength=function(d){var c=d.length,b;if(c===0){return 0}b=d[c-1];return(c-1)*32+util._getPartial(b)};util._partial=function(b,a,c){if(b===32){return a}return(c?a|0:a<<(32-b))+b*1099511627776};util.bitsToString=function(a,e){var d="",f,g=0,j=util._chars,b=0,h=util._bitLength(a);for(f=0;d.length*6<h;){d+=j.charAt((b^a[f]>>>g)>>>26);if(g<6){b=a[f]<<(6-g);g+=26;f++}else{b<<=6;g-=6}}while((d.length&3)&&!e){d+="="}return d};util.stringToBits=function(g){g=g.replace(/\s|=/g,"");var d=[],e,f=0,h=util._chars,b=0,a;for(e=0;e<g.length;e++){a=h.indexOf(g.charAt(e));if(a<0){throw new cjct.error("invalid format!")}if(f>26){f-=26;d.push(b^a>>>f);b=a<<(32-f)}else{f+=6;b^=a<<(32-f)}}if(f&56){d.push(util._partial(f&56,b,1))}return d};util.bitsToBytes=function(a){var b=[],e=util._bitLength(a),d,c;for(d=0;d<e/8;d++){if((d&3)===0){c=a[d/4]}b.push(c>>>24);c<<=8}return b};util.bytesToBits=function(a){var b=[],d,c=0;for(d=0;d<a.length;d++){c=c<<8|a[d];if((d&3)===3){b.push(c);c=0}}if(d&3){b.push(util._partial(8*(d&3),c))}return b};util.bitsToHex=function(b){var c="",d,a;for(d=0;d<b.length;d++){c+=((b[d]|0)+263882790666240).toString(16).substr(4)}return"0x"+c.substr(0,util._bitLength(b)/4)};util.hexToBits=function(d){var c,b=[],a;d=d.replace(/\s|0x/g,"");a=d.length;d=d+"00000000";for(c=0;c<d.length;c+=8){b.push(parseInt(d.substr(c,8),16)^0)}return util._clamp(b,a*4)};util.bitsToHexNew=function(b){var c="",d,a;for(d=0;d<b.length;d++){c+=((b[d]|0)+263882790666240).toString(16).substr(4)}return c.substr(0,util._bitLength(b)/4)};util.hexToBitsNew=function(d){var c,b=[],a;a=d.length;d=d+"00000000";for(c=0;c<d.length;c+=8){b.push(parseInt(d.substr(c,8),16)^0)}return util._clamp(b,a*4)};util.reset_format=function(b){var c=util.bitsToBytes(util.stringToBits(b));c=util.fixBytesLen(c,2*idak.FS+1);var a=c.slice(1,idak.FS+1);a=util.bitsToString(util.bytesToBits(a));var d=c.slice(idak.FS+1);d=util.bitsToString(util.bytesToBits(d));return"["+a+","+d+"]"};util.hex2pointFormat=function(b){var c=util.bitsToBytes(util.hexToBitsNew(b));c=util.fixBytesLen(c,2*idak.FS+1);var a=c.slice(1,idak.FS+1);a=util.bitsToString(util.bytesToBits(a));var d=c.slice(idak.FS+1);d=util.bitsToString(util.bytesToBits(d));return"["+a+","+d+"]"};util.change_format=function(c){var b=c.indexOf(",");var a=util.bitsToBytes(util.stringToBits(c.substring(1,b)));var e=util.bitsToBytes(util.stringToBits(c.substring(b+1,c.length-1)));a=util.fixBytesLen(a,idak.FS);e=util.fixBytesLen(e,idak.FS);var d=[4];d=d.concat(a).concat(e);return util.bitsToString(util.bytesToBits(d))};util.pointFormat2hex=function(c){var b=c.indexOf(",");var a=util.bitsToBytes(util.stringToBits(c.substring(1,b)));var e=util.bitsToBytes(util.stringToBits(c.substring(b+1,c.length-1)));a=util.fixBytesLen(a,idak.FS);e=util.fixBytesLen(e,idak.FS);var d=[4];d=d.concat(a).concat(e);return util.bitsToHexNew(util.bytesToBits(d))};var cjct={hash:sha256,bn:bn,ecc:ecc,idak:idak,util:util,error:function(a){this.toString=function(){return"ERROR: "+this.message};this.message=a}};mpinAuth={};mpinAuth.hash_val="";mpinAuth.DEBUG=false;mpinAuth.calculateMPinToken=function(f,e,h){var b,d,i,c,a,g;a=util.hex2pointFormat(e);g=new ecc.point.fromString(a,idak._curve);b=util.bitsToBytes(util.hexToBitsNew(h));d=idak._hashToPoint1(b);i=g.sub(d.smul(parseInt(f,10))).toString();c=util.pointFormat2hex(i);return c};mpinAuth.local_entropy=function(){var d,e,a,c,b;if(typeof(window)==="undefined"){if(mpinAuth.DEBUG){console.log("Test mode without browser")}return null}d=(window.crypto||window.msCrypto);if(typeof(d)!=="undefined"){e=new Uint32Array(8);d.getRandomValues(e);a="";for(c=0;c<e.length;c++){b=e[c].toString(16);a=a+b}if(mpinAuth.DEBUG){console.log("len(entropy_val): "+a.length+" entropy_val: "+a)}return a}return null};mpinAuth.randomX=function(){var k,c,d,g,a,h,b,j,f,e;k=mpinAuth.local_entropy();if(mpinAuth.DEBUG){console.log("start: local_entropy_val: "+k)}if(mpinAuth.DEBUG){console.log("start: mpinAuth.hash_val: "+mpinAuth.hash_val)}c=mpinAuth.hash_val+k;if(mpinAuth.DEBUG){console.log("hash_input_hex: "+c)}d=util.bitsToBytes(util.hexToBitsNew(c));g=new sha256();for(e=0;e<d.length;e++){g.update_byte(d[e])}a=util.wordsToBytes(g.finalize());h=util.bitsToHexNew(util.bytesToBits(a));if(mpinAuth.DEBUG){console.log("hash_output_hex "+h)}b=new bn(h);j=b.mod(idak._curve.r);f=j.toHexString();if(mpinAuth.DEBUG){console.log("random x "+f)}mpinAuth.hash_val=h;if(mpinAuth.DEBUG){console.log("end: mpinAuth.hash_val: "+mpinAuth.hash_val)}return j};mpinAuth.addShares=function(f,a){var h,e,d,c,g,b;h=util.hex2pointFormat(f);e=new ecc.point.fromString(h,idak._curve);if(mpinAuth.DEBUG){console.log("share1_hex: "+f)}d=util.hex2pointFormat(a);c=new ecc.point.fromString(d,idak._curve);if(mpinAuth.DEBUG){console.log("share2_hex: "+a)}g=e.add(c).toString();b=util.pointFormat2hex(g);if(mpinAuth.DEBUG){console.log("sum_hex: "+b)}return b};mpinAuth.pass1Request=function(g,k,r){var h,q,l,e,j,b,m,o,f,d,s,a,n,c,p;l=util.bitsToBytes(util.hexToBitsNew(k));if(mpinAuth.DEBUG){console.log("mpin_id: "+util.bytesToUnicode(l))}q=idak._hashToPoint1(l);b=new sha256();for(p=0;p<l.length;p++){b.update_byte(l[p])}b=util.wordsToBytes(b.finalize());m=util.bitsToHexNew(util.bytesToBits(b));if(mpinAuth.DEBUG){console.log("mpinAuth.pass1Request hash_mpin_id_hex: "+m)}if(mpinAuth.DEBUG){console.log("mpinAuth.pass1Request epoch_days: "+r)}o=idak._hashToPoint1(util.wordToBytes(r).concat(b));f=util.pointFormat2hex(o.toString());if(mpinAuth.DEBUG){console.log("mpinAuth.pass1Request date_mpin_id_hex: "+f)}d=idak.computeMPin_1x(q,g);s=util.pointFormat2hex(d);if(mpinAuth.DEBUG){console.log("U: "+d)}if(mpinAuth.DEBUG){console.log("U_hex: "+s)}e=util.pointFormat2hex(q.toString());j=g.toHexString();if(mpinAuth.DEBUG){console.log("mpinAuth.pass1Request mpin_id_pt: "+e)}if(mpinAuth.DEBUG){console.log("mpinAuth.pass1Request x_hex: "+j)}a=idak.computeMPin_1c(q,o,g);n=util.pointFormat2hex(a);if(mpinAuth.DEBUG){console.log("UT: "+a)}if(mpinAuth.DEBUG){console.log("UT_hex: "+n)}c={mpin_id:k,UT:n,U:s,pass:1};if(mpinAuth.DEBUG){console.dir(c)}return c};mpinAuth.pass2Request=function(h,b,l,o,a,q,g,i){var n,s,t,e,f,k,p,c,j,d;if(mpinAuth.DEBUG){console.log("mpin_id_hex: "+l)}if(mpinAuth.DEBUG){console.log("y_hex: "+b)}n=util.bitsToBytes(util.hexToBitsNew(l));if(mpinAuth.DEBUG){console.log("mpin_id: "+util.bytesToUnicode(n))}s=idak._hashToPoint1(n);if(mpinAuth.DEBUG){console.log("timePermit_hex: "+o)}t=util.hex2pointFormat(o);if(mpinAuth.DEBUG){console.log("token_hex: "+a)}e=util.hex2pointFormat(a);f=new bn(b);k=idak._curve.r;p=f.add(h).mod(k);p=k.sub(p).normalize();c=idak.computeMPin_1b(s,p,i,e,t);j=util.pointFormat2hex(c);if(mpinAuth.DEBUG){console.log("V: "+c)}if(mpinAuth.DEBUG){console.log("V_hex: "+j)}d={V:j,OTP:q,WID:g,pass:2};if(mpinAuth.DEBUG){console.dir(d)}return d};mpinAuth.sha256_hex=function(b){var d,a,f,e,c;a=util.bitsToBytes(util.hexToBitsNew(b));f=new sha256();for(c=0;c<a.length;c++){f.update_byte(a[c])}f=util.wordsToBytes(f.finalize());e=util.bitsToHexNew(util.bytesToBits(f));return e};function createXMLHttp(){if(typeof XMLHttpRequest!="undefined"){return new XMLHttpRequest()}else{if(window.ActiveXObject){var a=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"];for(var b=0;b<a.length;b++){try{var d=new ActiveXObject(a[b]);return d}catch(c){throw new Error("XMLHttp object could be created.")}}}}throw new Error("XMLHttp object could be created.")}function extractPIN(d,b,a,e){var c=mpinAuth.calculateMPinToken(d,b,a);e(c)}function getAuthToken(o,p,s,r,f,g,l,h,b,e,q,c,a,j){var i=mpinAuth.randomX();var d=s;var k=false;var m=false;setTimeout(function(){if(!k){if(!m){m=true;a(false,"WEBSOCKETERROR","WEB SOCKET ERROR")}}},5000);var n=new WebSocket(o);n.onerror=function(t){n.close();m=true;a(false,"WEBSOCKETERROR","WEB SOCKET ERROR");return};n.onopen=function(){var u=g||util.today();var t=mpinAuth.pass1Request(i,d,u);n.send(JSON.stringify(t))};n.onclose=function(){};n.onmessage=function(v){var t=JSON.parse(v.data);if(t.pass==1){k=true;if(m){return}var u=mpinAuth.pass2Request(i,t.y,d,r,f,l,h,b);n.send(JSON.stringify(u))}else{if(t.pass==2){var t=JSON.parse(v.data);n.close();sendAuthToken(e,t,a,q,c,j)}else{n.close();a(false,"SERVERERROR","SERVER ERROR")}}}}function getAuthTokenAjax(b,w,C,B,g,i,t,j,c,f,A,d,a,n){var h=(b.mpin_endsWith("/"))?b.slice(0,b.length-1):b;h=b.split("/authenticationToken").join("");var s=h.split("://");if(s[0]=="wss"){s[0]="https"}else{if(s[0]=="ws"){s[0]="http"}}h=s.join("://");var q=h+"/pass1";var p=h+"/pass2";var u=createXMLHttp();var l=mpinAuth.randomX();var e=C;var v=i||util.today();var o=mpinAuth.pass1Request(l,e,v);var r=JSON.stringify(o);var k="application/json";u.onreadystatechange=function(F){if(u.readyState==4){if(u.status==200){var G=u.responseText;var H=JSON.parse(G);var J=mpinAuth.pass2Request(l,H.y,e,B,g,t,j,c);J.mpin_id=e;var I=JSON.stringify(J);var E=createXMLHttp();E.onreadystatechange=function(L){if(E.readyState==4){if(E.status==200){var K=E.responseText;var M=JSON.parse(K);sendAuthToken(f,M,a,A,d,n)}else{console.error("Error PASS2 on Ajax Authentication Request: "+xmlhttpPass2.status);a(false,"SERVERERROR","SERVER ERROR")}}};E.open("POST",p,true);E.setRequestHeader("Content-Type",k);for(var D in d){E.setRequestHeader(D,d[D])}E.send(I)}else{console.error("Error PASS1 on Ajax Authentication Request: "+xmlhttpAuthToken.status);a(false,"SERVERERROR","SERVER ERROR")}}};u.open("POST",q,true);u.setRequestHeader("Content-Type",k);for(var m in d){u.setRequestHeader(m,d[m])}u.send(r)}function sendAuthToken(d,a,j,l,c,h){var i="application/json";var e;var g=a.OTP;delete a.OTP;var k={mpinResponse:a};if(l){k=l(k)}var b=JSON.stringify(k);var e=createXMLHttp();e.onreadystatechange=function(n){if(e.readyState==4){if(e.status==200){var o=e.responseText;var m;if(o){try{m=JSON.parse(o)}catch(p){m={}}}else{m={}}m._mpinOTP=g;if(h){h(m)}j(true,"OK","Authenticated",m)}else{if(e.status==401){j(false,"INVALID","INVALID PIN")}else{if(e.status==403){j(false,"NOTAUTHORIZED","You are not authorized!")}else{if(e.status==408){j(false,"EXPIRED","The request took too much time!")}else{if(e.status==410){j(false,"MAXATTEMPTS","Max Attempts Reached")}else{if(e.status==412){j(false,"INVALIDACCESSNUMBER","Invalid Access Number")}else{j(false,"INVOCATION","Invocation Errors Occured "+e.readyState+" and the status is "+e.status)}}}}}}}};e.open("POST",d,true);e.setRequestHeader("Content-Type",i);for(var f in c){e.setRequestHeader(f,c[f])}e.send(b)}function requestSignature(j,c,b,d,g,a){var i="application/json";var e=b+"?userid="+encodeURIComponent(j)+"&mobile="+c;var h=createXMLHttp();h.onreadystatechange=function(l){if(h.readyState==4){if(h.status==200){var m=h.responseText;var k=JSON.parse(m);g(k)}else{if(h.status==401){a("Error getting the mpin signature",h.status)}else{if(h.status==403){a("User not authorized",h.status)}else{a("Error getting the mpin signature",h.status)}}}}};h.open("GET",e,true);h.setRequestHeader("Content-Type",i);for(var f in d){h.setRequestHeader(f,d[f])}h.send()}function requestRegister(g,f,b,d,h,a){if(!d){d=function(j){return j}}var c=JSON.stringify(d({identity:mpinid}));var i=createXMLHttp();i.onreadystatechange=function(k){if(i.readyState==4){if(i.status==200){var l=xmlhttpSecret.responseText;var j=JSON.parse(l);h(j)}else{a(i.responseText,i.status)}}};i.open("POST",g,true);i.setRequestHeader("Content-Type","application/json");for(var e in b){i.setRequestHeader(e,b[e])}i.send(c)}function requestRPS(f,b){var e=new XMLHttpRequest(),d,c;d=f.method||"GET";f.postDataFormatter||(f.postDataFormatter=function(g){return g});c=JSON.stringify(f.postDataFormatter(f.data));e.onreadystatechange=function(){if(e.readyState===4){if(e.status===200){b(e.responseText?JSON.parse(e.responseText):{})}else{var g={};g.error=e.responseText;g.errorStatus=e.status;b(g)}}};e.open(d,f.URL,true);e.setRequestHeader("Content-Type","application/json");if(f.customHeaders){for(var a in f.customHeaders){e.setRequestHeader(a,f.customHeaders[a])}}e.send(c)}function RequestRPSJSON(d){var b;var e=d.method||"GET";if(e=="GET"){b=null}else{if(!d.postDataFormatter){d.postDataFormatter=function(f){return f}}b=JSON.stringify(d.postDataFormatter(d.data))}var c=createXMLHttp();c.onreadystatechange=function(g){if(c.readyState==4){if(c.status==200){if(d.onSuccess){var f=c.responseText?JSON.parse(c.responseText):{};d.onSuccess(f)}}else{if(d.onFail){d.onFail(c.status,c.responseText)}}}};if(d.onTimeout){c.ontimeout=function(){d.onTimeout()}}c.open(e,d.URL,true);if(d.timeout){c.timeout=d.timeout}c.myURL=d.URL;c.setRequestHeader("Content-Type","application/json");if(d.customHeaders){for(var a in d.customHeaders){c.setRequestHeader(a,d.customHeaders[a])}}c.send(b);this.abortRequest=function(){d.onFail=null;c.abort()};return this}function requestClientSecretShare(a,d,e){var c;var b="application/json";var c=createXMLHttp();c.onreadystatechange=function(g){if(c.readyState==4){if(c.status==200){var h=c.responseText;var f=JSON.parse(h);d(f.clientSecret)}else{if(c.status==401||c.status==403){var h=c.responseText;var f=JSON.parse(h);e("Error getting the client secret: "+c.status,c.status)}else{e("Error getting the client secret: "+c.status,c.status)}}}};c.open("GET",a,true);c.setRequestHeader("Content-Type",b);c.send()}function requestClientSecret(b,a,c,d){requestClientSecretShare(b,function(f){var e=mpinAuth.addShares(f,a);c(e)},d)}MPIN_LOADED=true;function requestTimePermitShare(b,e,f,g){var c;var d="application/json";var c=createXMLHttp();c.onreadystatechange=function(i){if(c.readyState==4){if(c.status==200){var j=c.responseText;var h=JSON.parse(j);f(h.timePermit,h)}else{var j=c.responseText;var h="";if(j){var h=JSON.parse(j)}g(h,c.status)}}};c.open("GET",b,true);c.setRequestHeader("Content-Type",d);for(var a in e){c.setRequestHeader(a,e[a])}c.send()}function requestTimePermitStorageShare(a,c,d){if(!a){d()}else{var b;var b=createXMLHttp();b.onreadystatechange=function(e){if(b.readyState==4){if(b.status==200){var f=b.responseText;c(f)}else{d()}}};b.open("GET",a,true);b.send()}}function requestTimePermit(f,a,e,d,c,g,h){var b=function(k,n,i,m){var l=mpinAuth.addShares(k,n);var j={date:i,timePermit:n};m(l,j,i)};requestTimePermitShare(a,e,function(m,k){var j=k.date;var l=k.storageId;var i=k.signature;var n=f+"&signature="+i;if((j)&&(j==d.date)){var p=d.timePermit;b(m,p,j,g)}else{var o=c(j,l);requestTimePermitStorageShare(o,function(q){b(m,q,j,g)},function(){requestTimePermitShare(n,{},function(q){b(m,q,j,g)},h)})}},h)};