/*!
Copyright 2015 CertiVox UK Ltd, All Rights Reserved.

The CertiVox M-Pin Client and Server Libraries are free software: you can
redistribute it and/or modify it under the terms of the BSD 3-Clause
License - http://opensource.org/licenses/BSD-3-Clause

For full details regarding our CertiVox terms of service please refer to
the following links:

  * Our Terms and Conditions -
    http://www.certivox.com/about-certivox/terms-and-conditions/

  * Our Security and Privacy -
    http://www.certivox.com/about-certivox/security-privacy/

  * Our Statement of Position and Our Promise on Software Patents -
    http://www.certivox.com/about-certivox/patents/
*/
;var mpin=mpin||{};(function(){var b={},c={};var h;var d="resources/templates/turquoise/img/";mpin=function(l,k){var j=this;h("js/handlebars.runtime.min.js",function(){h("js/mpin-all.min.js",function(){h("js/templates.js",function(){var m={};if(!k.clientSettingsURL){return console.error("set client Settings")}m.client=k;j.ajax(k.clientSettingsURL,function(n){if(n.error===500){m.server="";document.getElementById(l).innerHTML=mpin._.template(mpin.template.offline,{});return}m.server=n;j.initialize.call(j,l,m)})})})})};mpin.cfg={language:"en",pinSize:4,requiredOptions:"appID; signatureURL; mpinAuthServerURL; timePermitsURL; seedValue",defaultOptions:{identityCheckRegex:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,setDeviceName:false,accessNumberUseCheckSum:true},expireOtpSeconds:99,touchevents:true};mpin.prototype.initialize=function(k,j){this.el=document.getElementById(k);this.elHelp=document.getElementById("helpContainer");this.elHelpOverlay=document.getElementsByTagName("help")[0];this.elHelpHub=document.getElementsByTagName("helpHub")[0];this.accessNumber="";this.currentDate=null;Handlebars.registerHelper("hlp",function(l){return c.text(l)});Handlebars.registerHelper("img",function(l){return c.img(l)});Handlebars.registerHelper("loop",function(p,o){var l="";for(var m=0;m<p;++m){l+=o.fn(m)}return l});if(!j||!this.checkOptions(j.server)){return console.error("Some options are required: "+mpin.cfg.requiredOptions)}a();this.ds=this.dataSource();this.setDefaults().setOptions(j.server).setOptions(j.client);if(!this.opts.certivoxURL.mpin_endsWith("/")){this.opts.certivoxURL+="/"}if(this.opts.language&&b[this.opts.language]){this.language=this.opts.language}else{this.language=mpin.cfg.language}this.setLanguageText();document.ontouchmove=function(l){l.preventDefault()};this.renderHomeMobile()};mpin.prototype.checkOptions=function(n){var o;o=mpin.cfg.requiredOptions.split("; ");for(var m=0,j=o.length;m<j;m++){if(typeof n[o[m]]==="undefined"){return false}}return true};mpin.prototype.setDefaults=function(){this.opts||(this.opts={});for(var j in mpin.cfg.defaultOptions){this.opts[j]=mpin.cfg.defaultOptions[j]}this.opts.useWebSocket=("WebSocket" in window&&window.WebSocket.CLOSING===2);return this};mpin.prototype.setOptions=function(l){var o,n,k,j="stage; allowAddUser; requestOTP; successSetupURL; onSuccessSetup; successLoginURL; onSuccessLogin; onLoaded; onGetPermit; ";j+="onReactivate; onAccountDisabled; onUnsupportedBrowser; prerollid; onError; onGetSecret; mpinDTAServerURL; signatureURL; verifyTokenURL; certivoxURL; ";j+="mpinAuthServerURL; registerURL; accessNumberURL; mobileAppFullURL; authenticateHeaders; authTokenFormatter; accessNumberRequestFormatter; ";j+="registerRequestFormatter; onVerifySuccess; mobileSupport; emailCheckRegex; seedValue; appID; useWebSocket; setupDoneURL; timePermitsURL; timePermitsStorageURL; authenticateURL; ";j+="language; customLanguageTexts; accessNumberDigits; mobileAuthenticateURL; setDeviceName; getAccessNumberURL; cSum; accessNumberUseCheckSum";n=j.split("; ");this.opts||(this.opts={});for(var o=0,m=n.length;o<m;o++){k=n[o];if(typeof l[k]!=="undefined"){this.opts[k]=l[k]}}mpinAuth.hash_val=this.opts.seedValue;if(this.opts.mpinAuthServerURL.mpin_startsWith("http")){this.opts.useWebSocket=false}if(this.opts.mpinAuthServerURL.mpin_startsWith("/")){var q=window.location;var p;if(this.opts.useWebSocket){p=(q.protocol==="https:")?"wss:":"ws:"}else{p=q.protocol}p+="//"+q.host+this.opts.mpinAuthServerURL;this.opts.mpinAuthServerURL=p}this.opts.mpinAuthServerURL=(this.opts.mpinAuthServerURL.mpin_endsWith("/"))?this.opts.mpinAuthServerURL.slice(0,this.opts.mpinAuthServerURL.length-1):this.opts.mpinAuthServerURL;return this};mpin.prototype.readyHtml=function(m,j){var l=j,k;k=mpin.templates[m]({data:l,cfg:mpin.cfg});return k};mpin.prototype.readyHelpHub=function(m,j){var l=j,k;k=mpin.templates[m]({data:l,cfg:mpin.cfg});return k};mpin.prototype.render=function(o,m,l){var n=l||{},j;this.el.innerHTML=this.readyHtml(o,n);for(j in m){if(document.getElementById(j)&&j!=="menuBtn"){if(window.navigator.msPointerEnabled){document.getElementById(j).addEventListener("MSPointerDown",m[j],false)}else{if(mpin.cfg.touchevents){document.getElementById(j).addEventListener("touchstart",m[j],false)}else{document.getElementById(j).addEventListener("click",m[j],false)}}}else{if(document.getElementById(j)&&j==="menuBtn"){document.getElementById("menuBtn").addEventListener("click",m[j],false)}}}};mpin.prototype.renderHelpHub=function(p,m){var o=m||{},l,j=this,n={};j.dismissHelp();this.elHelpHub.style.display="flex";this.elHelpHub.style.opacity="1";this.elHelpHub.innerHTML=this.readyHelpHub(p,o);n.first=function(k){};n.second=function(k){};n.details=function(k){j.renderHelpHub("helphub-details")};n.forth=function(k){};n.enter=function(k){j.renderHelpHub("helphub-index")};n.exit=function(k){j.dismissHelpHub()};for(l in n){if(document.getElementById(l)){if(window.navigator.msPointerEnabled){document.getElementById(l).addEventListener("MSPointerDown",n[l],false)}else{if(mpin.cfg.touchevents){document.getElementById(l).addEventListener("touchstart",n[l],false)}else{document.getElementById(l).addEventListener("click",n[l],false)}}}}};mpin.prototype.dismissHelp=function(){this.elHelpOverlay.style.display="none";this.elHelpOverlay.style.opacity="0";this.elHelp.style.display="none"};mpin.prototype.dismissHelpHub=function(){this.elHelpHub.style.display="none";this.elHelpHub.style.opacity="0"};mpin.prototype.setLanguageText=function(){c.language=this.language;if(this.opts.customLanguageTexts&&this.opts.customLanguageTexts[this.language]){for(var j in this.opts.customLanguageTexts[this.language]){if(b[this.language][j]){b[this.language][j]=this.opts.customLanguageTexts[this.language][j]}}}};mpin.prototype.renderHomeMobile=function(){var n={},t=this,o,m,j,s,k;n.mpin_authenticate=function(u){t.renderSetupHome.call(t)};n.ok_dismiss=function(u){t.dismissHelp.call(t)};n.show_more=function(u){t.renderHelp("help-helphub",n)};n.info=function(u){t.renderHelp("help-setup-home",n)};n.mp_action_setup=function(u){t.actionSetupHome.call(t)};o=this.ds.getDefaultIdentity();m=window.navigator.standalone;s=window.navigator.userAgent.toLowerCase(),j=/safari\//.test(s);k=/iphone|ipod|ipad/.test(s);function q(){var u=s;return/(iphone|ipod|ipad).* os 7_/.test(u)}function p(){var u=s;return/(iphone|ipod|ipad).* os 8_/.test(u)}function r(){var u=s;return/(iphone|ipod|ipad).* os 6_/.test(u)}function l(){if(!navigator.onLine){t.render("offline",n)}else{if(o){totalAccounts=t.ds.getAccounts();totalAccounts=Object.keys(totalAccounts).length;if(totalAccounts===0){t.renderSetupHome()}else{if(totalAccounts===1||totalAccounts>1){t.renderAccessNumber()}}}else{t.renderSetupHome()}}}if(k){if(!m&&j){if(s.match("crios")){l();return}if(q()||p()){this.render("ios7-startup",n)}else{if(r()){this.render("ios6-startup",n)}else{l()}}}else{if(m&&!j){l()}else{if(!m&&!j){this.render("ui-webview",n)}}}}else{l()}};mpin.prototype.renderSetupHome=function(p,l){var n={},t=this,m,k,o="",q="";var r=this.ds.getAccounts();r=Object.keys(r).length;n.mp_action_home=function(u){if(r===0){t.renderSetupHome()}else{if(r===1){t.renderAccessNumber()}else{if(r>1){t.renderAccessNumber(true)}}}};n.mp_action_setup=function(u){t.actionSetupHome.call(t)};m=(p)?p:"";if(this.opts.setDeviceName){if(this.ds.getDeviceName()){o=this.ds.getDeviceName();q=o}else{q=this.suggestDeviceName();o=""}}this.render("setup-home",n,{userId:m,setDeviceName:this.opts.setDeviceName});var s=document.getElementById("deviceInput"),j=document.getElementById("emailInput");s.placeholder=q;s.value=o;j.placeholder=c.text("setup_text3")};mpin.prototype.renderOtp=function(l){var o={},t=this,k,n,m,r,s;r=function(u){var w,v;v=s-u;w=-0.5+((v/s)*2);w=Math.round(w*100)/100;m.clearRect(0,0,n.width,n.height);m.beginPath();m.strokeStyle="#8588ac";m.arc(20,20,18,w*Math.PI,1.5*Math.PI);m.lineWidth=5;m.stroke()};function j(u){k=(k)?k-1:Math.floor((u-(new Date()))/1000);if(k>0){document.getElementById("mpin_seconds").innerHTML=k;if(document.getElementById("mpTimer")){r(k)}}else{clearInterval(t.intervalExpire);t.renderOtpExpire()}}o.mp_action_home=function(){clearInterval(t.intervalExpire);t.renderHomeMobile.call(t)};o.mpin_help=function(){clearInterval(t.intervalExpire);t.lastView="renderOtp";t.renderHelpHub.call(t)};o.mpin_cancel=function(){clearInterval(t.intervalExpire);t.renderLogin.call(t)};this.render("otp",o);document.getElementById("mpinOTPNumber").innerHTML=l._mpinOTP;var p=new Date()-new Date(l.nowTime);var q=new Date(l.expireTime+p);s=Math.floor((q-(new Date()))/1000);if(document.getElementById("mpTimer")){n=document.getElementById("mpTimer");m=n.getContext("2d")}j(q);this.intervalExpire=setInterval(function(){j()},1000)};mpin.prototype.renderOtpExpire=function(){var k={},j=this;k.mpin_login_now=function(){j.renderLogin.call(j)};this.render("otp-expire",k)};mpin.prototype.suggestDeviceName=function(){var l,j,k;j=navigator.platform.toLowerCase();k=navigator.userAgent;if(j.indexOf("mac")!==-1){j="mac"}else{if(j.indexOf("linux")!==-1){j="lin"}else{if(j.indexOf("win")!==-1){j="win"}else{if(j.indexOf("sun")!==-1){j="sun"}else{if(j.indexOf("iphone")!==-1){j="iOS"}else{j="__"}}}}}if(k.indexOf("Chrome")!==-1){k="Chrome"}else{if(k.indexOf("MSIE")!==-1||k.indexOf("Trident")!==-1){k="Explorer"}else{if(k.indexOf("Firefox")!==-1){k="Firefox"}else{if(k.indexOf("Safari")!==-1){k="Safari"}else{if(k.indexOf("iPhone")!==-1){k="iPhone"}else{k="_"}}}}}l=j+k;return l};mpin.prototype.renderSetup=function(l,k,n){var m={},j=this;var o=this.ds.getAccounts();o=Object.keys(o).length;m.mp_action_home=function(p){if(o===0){j.renderSetupHome()}else{if(o===1){j.renderAccessNumber()}else{if(o>1){j.renderAccessNumber(true)}}}};m.mpinClear=function(){j.addToPin.call(j,"clear")};m.mpinLogin=function(){if(j.pinpadInput.length<mpin.cfg.pinSize){return}j.actionSetup.call(j)};m.menuBtn=function(){j.toggleButton.call(j)};m.show_more=function(p){j.renderHelpHub("helphub-index",m)};m.info=function(p){j.renderHelp("help-setup-home",m)};this.render("setup-pin",m,{email:l,pinSize:mpin.cfg.pinSize});this.enableNumberButtons(false);this.bindNumberButtons();this.addToPin.call(j,"clear");this.requestSignature(l,k,n)};mpin.prototype.renderAccessNumber=function(j){var n={},l=this,k=this.ds.getDefaultIdentity(),m=this.getDisplayName(k),o=this.ds.getAccounts();o=Object.keys(o).length;if(!k){this.renderSetupHome()}if(!this.identity){l.setIdentity(l.ds.getDefaultIdentity(),true)}if(l.opts.requestOTP==="1"){l.renderLogin();return}n.mp_action_home=function(p){if(document.getElementById("menuBtn").classList.contains("close")){document.getElementById("menuBtn").onclick()}return;if(o===0){l.renderSetupHome()}else{if(o===1){l.renderAccessNumber()}else{if(o>1){l.renderAccessNumber(true)}}}};n.mpinClear=function(){l.addToAcc.call(l,"clear",false)};n.menuBtn=function(){l.toggleButton.call(l)};n.mpinLogin=function(){if(l.accessNumber.length<l.opts.accessNumberDigits){return}if(!l.opts.accessNumberUseCheckSum){l.renderLogin.call(l);return}if(l.opts.cSum===1&&!l.checkAccessNumberValidity2(l.accessNumber,6)){l.renderAccessNumber.call(l);l.addToAcc.call(l,"clear",false);l.display(c.text("authPin_errorInvalidAccessNumber"),true);return}if(!l.checkAccessNumberValidity(l.accessNumber,1)&&l.opts.cSum!==1){l.renderAccessNumber.call(l);l.addToAcc.call(l,"clear",false);l.display(c.text("authPin_errorInvalidAccessNumber"),true);return}l.renderLogin()};this.render("setup-access",n,{email:m,menu:true});l.enableNumberButtons(true);l.enableButton(false,"go");l.enableButton(false,"clear");l.bindNumberButtons(true);l.addToAcc.call(l,"clear",false);if(j){this.toggleButton()}else{this.setIdentity(this.ds.getDefaultIdentity(),true,function(){l.display(c.text("pinpad_placeholder_text"))},function(){return false})}};mpin.prototype.renderLogin=function(j){var o={},l=this,k=this.ds.getDefaultIdentity(),m=this.getDisplayName(k),p=this.ds.getAccounts(),n=document.getElementById("pinpad-input");o.mp_action_home=function(q){if(p===0){l.renderSetupHome()}else{if(p===1){l.renderAccessNumber()}else{if(p>1){l.renderAccessNumber(true)}}}};o.mpinClear=function(){l.addToPin.call(l,"clear")};o.menuBtn=function(){l.toggleButton.call(l)};o.mpinLogin=function(){if(l.pinpadInput.length<mpin.cfg.pinSize){return}l.actionLogin.call(l)};this.pinpadInput="";this.render("setup",o,{email:m,menu:true,pinSize:mpin.cfg.pinSize});this.enableNumberButtons(false);this.bindNumberButtons();o.ok_dismiss=function(q){l.dismissHelp.call(l)};o.show_more=function(q){l.renderHelpHub("helphub-index")};document.getElementById("openHelpHub").onclick=function(q){l.renderHelpHub("helphub-index")};if(j){this.toggleButton()}else{this.setIdentity(this.ds.getDefaultIdentity(),true,function(){l.display(c.text("pinpad_placeholder_text"))},function(){return false})}};mpin.prototype.getAccessNumber=function(){var l=new XMLHttpRequest(),k=this,j,o,m,p,n;this.intervalID||(this.intervalID={});if(document.getElementById("mpTimer")){m=document.getElementById("mpTimer");p=m.getContext("2d")}o=function(q){var s,r;r=n-q;s=-0.5+((r/n)*2);s=Math.round(s*100)/100;p.clearRect(0,0,m.width,m.height);p.beginPath();p.strokeStyle="#8588ac";p.arc(20,20,18,s*Math.PI,1.5*Math.PI);p.lineWidth=5;p.stroke()};j=function(q){var r=Math.floor((q-(new Date()))/1000);if(r<=0){if(k.intervalID){clearInterval(k.intervalID)}k.getAccessNumber()}else{document.getElementById("mpin_seconds").innerHTML=r;if(document.getElementById("mpTimer")){o(r)}}};l.onreadystatechange=function(){var r,q;if(l.readyState===4&&l.status===200){r=JSON.parse(l.responseText);document.getElementById("mp_accessNumber").innerHTML=r.accessNumber;if(r.webOTP){k.webOTP=r.webOTP}q=new Date();n=99;q.setSeconds(q.getSeconds()+r.ttlSeconds);j(q);k.intervalID=setInterval(function(){j(q)},1000)}};l.open("POST",this.opts.getAccessNumberURL);l.send()};mpin.prototype.getAccess=function(){var k=new XMLHttpRequest(),j=this;k.onreadystatechange=function(){var m;if(k.readyState===4){if(k.status===200){m=JSON.parse(k.responseText);if(j.opts.onVerifySuccess){j.opts.onVerifySuccess(m)}else{j.successLogin(m)}}else{}}};k.open("POST",this.opts.accessNumberURL,true);k.timeout=30000;k.ontimeout=function(){j.getAccess()};var l={};if(this.webOTP){sendParams.webOTP=this.webOTP;k.send(JSON.stringify(l))}else{k.send()}return k};mpin.prototype.renderActivateIdentity=function(){var l={},j=this,k;k=this.getDisplayName(this.identity);l.mp_action_home=function(m){j.renderHomeMobile.call(j)};l.mpin_action_setup=function(m){if(j.checkBtn(this)){j.beforeRenderSetup.call(j,this)}};l.mpin_action_resend=function(m){if(j.checkBtn(this)){j.actionResend.call(j,this)}};l.mpin_accounts=function(){j.renderAccountsBeforeSetup()};this.render("activate-identity",l,{email:k})};mpin.prototype.checkBtn=function(j){var k=j.className;return(k.indexOf("mpinBtnBusy")===-1&&k.indexOf("mpinBtnError")===-1&&k.indexOf("mpinBtnOk")===-1)};mpin.prototype.mpinButton=function(k,j){var l=k.innerHTML;f(k,"mpinBtnBusy");k.innerHTML="<span class='btnLabel'>"+c.text(j)+"</span>";return{error:function(m){i(k,"mpinBtnBusy");f(k,"mpinBtnError");k.innerHTML="<span class='btnLabel'>"+c.text(m)+"</span>";setTimeout(function(){i(k,"mpinBtnError");k.innerHTML=l},1500)},ok:function(m){i(k,"mpinBtnBusy");f(k,"mpinBtnOk");k.innerHTML="<span class='btnLabel'>"+c.text(m)+"</span>";setTimeout(function(){i(k,"mpinBtnOk");k.innerHTML=l},1500)}}};mpin.prototype.beforeRenderSetup=function(l){var j={},o,m,k=this;o=this.ds.getIdentityData(this.identity,"regOTT");m=this.opts.signatureURL+"/"+this.identity+"?regOTT="+o;if(l){var n=this.mpinButton(l,"setupNotReady_check_info1")}j.URL=m;j.method="GET";requestRPS(j,function(q){if(q.errorStatus){n.error("setupNotReady_check_info2");k.error("Activate identity");return}var p=k.getDisplayName(k.identity);k.renderSetup(p,q.clientSecretShare,q.params)})};mpin.prototype.renderAccountsPanel=function(n){var t=this,p={},r,k,q=0,o=document.getElementById("mp_back"),l=document.getElementById("menuBtn"),s;if(!o){o=document.getElementById("mp_back_not_active")}if(window.navigator.msPointerEnabled){l.style.bottom="0"}if(l){l.onclick=function(u){document.getElementById("accountTopBar").style.height="";l.className="up"}}k=function(u){var v=document.createElement("div");v.className="mp_contentEmptyItem";u.appendChild(v)};addMpinBack=function(){if(document.getElementById("accountTopBar")){r=document.getElementById("accountTopBar").appendChild(document.createElement("div"));r.id="mp_back";o=document.getElementById("mp_back");if(!document.getElementById("mp_back")){o=document.getElementById("mp_back_not_active")}o.innerHTML=t.readyHtml("accounts-panel",{})}};if(document.body.contains(o)===false||document.body.contains(o)===false){addMpinBack();o.style.display="block";document.getElementById("mp_acclist_adduser").onclick=function(u){t.renderSetupHome.call(t)};var j=document.getElementById("mp_accountContent");this.addUserToList(j,this.ds.getDefaultIdentity(),true,0);for(var m in this.ds.getAccounts()){q+=1;if(m!=this.ds.getDefaultIdentity()){this.addUserToList(j,m,false,q)}}k(j)}};mpin.prototype.renderAccountsBeforeSetupPanel=function(n){var t=this,p={},r,k,q=0,o=document.getElementById("mp_back_not_active"),l=document.getElementById("menuBtn"),s;if(window.navigator.msPointerEnabled){l.style.bottom="0"}k=function(u){var v=document.createElement("div");v.className="mp_contentEmptyItem";u.appendChild(v)};addMpinBack=function(){r=document.getElementById("identityContainer").appendChild(document.createElement("div"));r.id="mp_back_not_active";o=document.getElementById("mp_back_not_active");o.innerHTML=t.readyHtml("accounts-panel-not-active",{})};if(document.body.contains(o)===false){addMpinBack();o.style.display="block";document.getElementById("mp_go_back").onclick=function(u){t.renderIdentityNotActive.call(t)};var j=document.getElementById("mp_accountContent");this.addUserToList(j,this.ds.getDefaultIdentity(),true,0);for(var m in this.ds.getAccounts()){q+=1;if(m!=this.ds.getDefaultIdentity()){this.addUserToList(j,m,false,q)}}k(j)}};mpin.prototype.renderUserSettingsPanel=function(m){var l,k,j=this,k=this.getDisplayName(m),n;if(document.getElementById("mp_back")){l=document.getElementById("mp_back");n="mp_back"}else{l=document.getElementById("mp_back_not_active");n="mp_back_not_active"}l.innerHTML=this.readyHtml("user-settings",{name:k});document.getElementById("mp_deluser").onclick=function(o){j.renderDeletePanel.call(j,m)};document.getElementById("mp_reactivate").onclick=function(o){j.renderReactivatePanel.call(j,m)};document.getElementById("mp_acclist_cancel").onclick=function(o){l.parentNode.removeChild(l);if(n==="mp_back"){j.renderAccountsPanel()}else{j.renderAccountsBeforeSetupPanel()}}};mpin.prototype.renderReactivatePanel=function(m){var l,k,j=this;k=this.getDisplayName(m);if(document.getElementById("mp_back")){l=document.getElementById("mp_back")}else{l=document.getElementById("mp_back_not_active")}l.innerHTML=this.readyHtml("reactivate-panel",{name:k});document.getElementById("mp_acclist_reactivateuser").onclick=function(){j.actionSetupHome.call(j,j.getDisplayName(m))};document.getElementById("mp_acclist_cancel").onclick=function(){j.renderUserSettingsPanel(m)}};mpin.prototype.renderDeletePanel=function(m){var l,k,j=this;k=this.getDisplayName(m);if(document.getElementById("mp_back")){l=document.getElementById("mp_back")}else{l=document.getElementById("mp_back_not_active")}l.innerHTML=this.readyHtml("delete-panel",{name:k});document.getElementById("mp_acclist_deluser").onclick=function(n){j.deleteIdentity(m);j.renderHomeMobile.call(j,n)};document.getElementById("mp_acclist_cancel").onclick=function(n){j.renderUserSettingsPanel(m)}};mpin.prototype.renderSetupDone=function(){var l={},j=this,k;k=this.getDisplayName(this.identity);l.mp_action_home=function(){j.renderHomeMobile.call(j)};l.mp_action_go=function(){j.renderAccessNumber.call(j)};this.render("setup-done",l,{userId:k})};mpin.prototype.addUserToList=function(m,v,n,s){var r,o,w=this,p;if(n){r="mp_starButtonSelectedState";o="mp_contentItem one-edge-shadow default"}else{r="mp_starButtonDefaultState";o="mp_contentItem one-edge-shadow"}p=document.createElement("div");var j=this.getDisplayName(v);p.setAttribute("tabindex","-1");p.className=r;p.id="mp_accountItem_"+s;var k=document.createElement("div");k.className=o;k.setAttribute("data-identity",v);k.appendChild(p);var x={name:j};k.innerHTML=mpin.templates["user-row"]({data:x,cfg:mpin.cfg});m.appendChild(k);k.addEventListener("click",t,false);function t(z){z.stopPropagation();z.preventDefault();if(document.getElementById("mp_back")){var y=document.getElementById("mp_back")}else{var y=document.getElementById("mp_back_not_active")}y.parentNode.removeChild(y);i(document.getElementsByClassName("mp_itemSelected")[0],"mp_itemSelected");w.ds.setDefaultIdentity(v);w.setIdentity(v,true);w.renderAccessNumber();w.addToAcc.call(w,"clear",false);menuBtn=document.getElementById("menuBtn");document.getElementById("accountTopBar").style.height="";menuBtn.className="up"}var l="mp_btIdSettings_",q=document.getElementById(l),u=c.img("settings.svg");q.setAttribute("id",l+s);document.getElementById(l+s).onclick=function(y){w.renderUserSettingsPanel(v);y.stopPropagation();return false}};mpin.prototype.renderIdentityNotActive=function(k){var l={},j=this;var k=k?k:j.getDisplayName(this.identity);l.mp_action_home=function(m){j.renderHomeMobile()};l.mpin_action_setup=function(){if(j.checkBtn(this)){j.beforeRenderSetup.call(j,this)}};l.mpin_action_resend=function(){if(j.checkBtn(this)){j.actionResend.call(j,this)}};l.mpin_accounts=function(){j.renderAccountsBeforeSetup()};this.render("identity-not-active",l,{email:k})};mpin.prototype.bindNumberButtons=function(k){var j=this,n;n=document.getElementsByClassName("btn");function m(p){p.stopPropagation();p.preventDefault();var o=document.getElementById("inputContainer");var q=document.getElementById("codes");if(p.target.hasAttribute("disabled")){return}k?j.addToAcc(p.target.getAttribute("data-value"),""):j.addToPin(p.target.getAttribute("data-value"),"")}for(var l=0;l<n.length;l++){if(window.navigator.msPointerEnabled){n[l].addEventListener("MSPointerDown",m,false)}else{if(mpin.cfg.touchevents){n[l].addEventListener("touchstart",m,false)}else{n[l].addEventListener("click",m,false)}}}};mpin.prototype.enableNumberButtons=function(j){var m=document.getElementsByClassName("btn");for(var l=0;l<m.length;l++){var k=m[l];if(j){k.className="btn";k.disabled=false}else{k.className="btn disabled";k.disabled=true}}};mpin.prototype.addToPin=function(n,m){var l,k=document.getElementById("codes"),j=this;this.pinpadInput||(this.pinpadInput="");this.pinpadInput+=n;l=this.pinpadInput.length;if(n==="login"){k.style.display="block";k.innerHTML=c.text("pinpad_placeholder_text");this.enableNumberButtons(true);return}if(n==="pin"){k.style.display="block";k.innerHTML=c.text("pinpad_placeholder_text");this.enableNumberButtons(true);return}if(l===1){this.resetDisplay(c.text("pinpad_placeholder_text"));this.enableButton(true,"clear")}if(l<=mpin.cfg.pinSize){this.bindCircles()}if(l===mpin.cfg.pinSize){this.enableNumberButtons(false);this.enableButton(true,"go");this.enableButton(true,"clear")}if(n==="clear"){this.enableNumberButtons(true);this.enableButton(false,"go");this.enableButton(false,"clear");this.pinpadInput="";this.clearCircles()}};mpin.prototype.addToAcc=function(o,n){var m,l=document.getElementById("codes"),j=document.getElementById("accNumHolder"),k=this;this.accessNumber+=o;m=this.accessNumber.length;j.style.display="block";j.innerHTML+=o;if(m===1){this.resetDisplay(c.text("pinpad_placeholder_text"));this.enableButton(true,"clear")}if(m===this.opts.accessNumberDigits){this.enableNumberButtons(false);this.enableButton(true,"go");this.enableButton(true,"clear")}if(o==="clear"){k.display(c.text("pinpad_placeholder_text2"));l.style.display="block";l.className="";this.enableNumberButtons(true);this.enableButton(false,"go");this.enableButton(false,"clear");this.accessNumber="";if(n){j.innerHTML="";this.enableNumberButtons(true)}else{this.accessNumber="";j.innerHTML="";this.enableNumberButtons(true)}}};mpin.prototype.enableButton=function(m,j){var l={},k;l.go={id:"mpinLogin",trueClass:"btnLogin",falseClass:"btnLogin disabled"};l.clear={id:"mpinClear",trueClass:"btnClear",falseClass:"btnClear disabled"};l.toggle={id:"mp_toggleButton",trueClass:"mp_DisabledState",falseClass:""};k=document.getElementById(l[j].id);if(!l[j]||!k){return}k.disabled=!m;k.className=l[j][m+"Class"]};mpin.prototype.display=function(l,j){var k=document.getElementById("codes");k.style.display="block";k.className="error";k.innerHTML=l};mpin.prototype.resetDisplay=function(k){var j=document.getElementById("codes");j.style.display="none";j.innerHTML=k};mpin.prototype.bindCircles=function(){var j=document.getElementById("pinpad-input");var l=document.createElement("div");l.className="inner-circle";var k="mpin_circle_"+(this.pinpadInput.length-1);document.getElementById(k).appendChild(l)};mpin.prototype.clearCircles=function(){var k=mpin.cfg.pinSize,l=[];for(var j=0;j<=k;j++){l[j]=document.getElementById("mpin_circle_"+j);if(l[j]&&l[j].childNodes[3]){l[j].removeChild(l[j].childNodes[3])}}};mpin.prototype.getDisplayName=function(k){if(!k){k=this.identity}try{return JSON.parse(g(k)).userID}catch(j){return k}};mpin.prototype.toggleButton=function(){var l=this;var j=document.getElementById("accountTopBar");var k=document.getElementById("menuBtn");if(k&&!k.classList.contains("close")){j.style.height="100%";k.className="close";i("mp_toggleButton","mp_SelectedState");i("mp_panel","mp_flip");this.renderAccountsPanel()}else{if(this.ds.getIdentityToken(this.identity)==""){identity=this.getDisplayName(this.identity);this.renderIdentityNotActive(identity);return}}return false};mpin.prototype.renderAccountsBeforeSetup=function(){var k=this;var j=document.getElementById("identityContainer");this.setIdentity(this.identity,true,function(){},function(){return false});j.style.height="100%";i("mp_toggleButton","mp_SelectedState");i("mp_panel","mp_flip");this.renderAccountsBeforeSetupPanel();return false};mpin.prototype.actionSetupHome=function(m){var o,k,n,j={},l=this;o=(m)?m:document.getElementById("emailInput").value;if(o.length===0||!this.opts.emailCheckRegex.test(o)){document.getElementById("emailInput").focus();return}j.URL=this.opts.registerURL;j.method="PUT";j.data={userId:o,mobile:1};n=(document.getElementById("deviceInput"))?document.getElementById("deviceInput").value.trim():"";if(!this.ds.getDeviceName()&&n===""){k=this.suggestDeviceName()}else{if(!this.ds.getDeviceName()&&n!==""){k=n}else{if(n!==this.ds.getDeviceName()){k=n}else{k=false}}}if(k){this.ds.setDeviceName(k)}if(this.opts.setDeviceName){j.data.deviceName=(n==="")?this.suggestDeviceName():n}requestRPS(j,function(p){if(p.error){l.error("Activate First");return}l.ds.addIdentity(p.mpinId,"");l.ds.setIdentityData(p.mpinId,{regOTT:p.regOTT});l.ds.setDefaultIdentity(p.mpinId);l.identity=p.mpinId;l.ds.deleteOldIdentity(p.mpinId);if(p.active){l.beforeRenderSetup()}else{l.renderActivateIdentity()}})};mpin.prototype.requestSignature=function(l,k,m){var j=this;requestClientSecret(j.certivoxClientSecretURL(m),k,function(n){j.enableNumberButtons(true);j.clientSecret=n;if(j.opts.onGetSecret){j.opts.onGetSecret()}},function(o,n){j.error(o,n)})};mpin.prototype.error=function(j){if(this.opts.onError){this.opts.onError(j)}else{console.error("Error : "+j)}};mpin.prototype.actionResend=function(l){var k=this,j={},n,o,m;n=this.ds.getIdentityData(this.identity,"regOTT");o=this.getDisplayName(this.identity);m=this.mpinButton(l,"setupNotReady_resend_info1");j.URL=this.opts.registerURL;j.URL+="/"+this.identity;j.method="PUT";j.data={userId:o,mobile:1,regOTT:n};if(this.opts.registerRequestFormatter){j.postDataFormatter=this.opts.registerRequestFormatter}if(this.opts.customHeaders){j.customHeaders=this.opts.customHeaders}requestRPS(j,function(p){if(p.error||p.errorStatus){k.error("Resend problem");return}if(k.identity!==p.mpinId){k.ds.deleteIdentity(k.identity);k.identity=p.mpinId;k.ds.addIdentity(k.identity,"");k.ds.setDefaultIdentity(k.identity)}k.ds.setIdentityData(k.identity,{regOTT:p.regOTT});k.ds.deleteOldIdentity(p.mpinId);m.ok("setupNotReady_resend_info2")})};mpin.prototype.actionSetup=function(){var j=this,k;k=this.pinpadInput;this.ds.addIdentity(this.identity,"");this.display(c.text("verify_pin"));extractPIN(k,this.clientSecret,this.identity,function(n){j.ds.setIdentityToken(j.identity,n);j.clientSecret="";j.enableNumberButtons(false);j.enableButton(false,"go");j.ds.setDefaultIdentity(j.identity);j.ds.deleteOldIdentity(j.identity);j.display(c.text("setupPin_pleasewait"),false);if(j.opts.setupDoneURL){var l={},m=j.opts.setupDoneURL+"/"+j.identity;l.URL=m;l.method="POST";l.data={};requestRPS(l,function(o){if(o.errorStatus){j.error("ooops");return}j.successSetup()})}else{j.successSetup()}})};mpin.prototype.actionLogin=function(){var n={},k,o,j=this,m=this.pinpadInput,l;this.enableNumberButtons(false);this.enableButton(false,"go");this.enableButton(false,"clear");this.enableButton(true,"toggle");this.display(c.text("authPin_pleasewait"));if(this.opts.useWebSocket){o=getAuthToken;k=this.opts.mpinAuthServerURL+"/authenticationToken"}else{o=getAuthTokenAjax;k=this.opts.mpinAuthServerURL}l=this.accessNumber;o(k,this.opts.appID,this.identity,this.ds.getIdentityPermit(this.identity),this.ds.getIdentityToken(this.identity),this.currentDate,this.opts.requestOTP,l?l:"0",m,this.opts.requestOTP?this.opts.authenticateURL:this.opts.mobileAuthenticateURL,this.opts.authenticateRequestFormatter,this.opts.customHeaders,function(t,r,p,q){if(t){var s=j.identity;if(j.opts.requestOTP){j.renderOtp(q);return}j.successLogin(q,s)}else{if(r==="INVALID"){j.addToPin.call(j,"clear");j.display(c.text("authPin_errorInvalidPin"),true);j.enableNumberButtons(true);j.enableButton(false,"go");j.enableButton(false,"clear");j.enableButton(true,"toggle")}else{if(r==="MAXATTEMPTS"){var s=j.identity;j.deleteIdentity(s);if(j.opts.onAccountDisabled){j.opts.onAccountDisabled(s)}n.mp_action_register=function(u){var v=j.getDisplayName(s);j.renderSetupHome.call(j,v)};n.mp_action_home=function(u){j.renderHomeMobile.call(j)};j.render("access-denied",n,{email:j.getDisplayName(s)})}else{if(r==="INVALIDACCESSNUMBER"){j.renderAccessNumber.call(j);j.addToAcc.call(j,"clear",false);j.display(c.text("authPin_errorInvalidAccessNumber"),true)}else{if(r==="NOTAUTHORIZED"){j.display(c.text("authPin_errorNotAuthorized"),true)}else{if(r==="EXPIRED"){j.display(c.text("authPin_errorExpired"),true)}else{if(r==="WEBSOCKETERROR"){console.error("WebSocket connection fail! Falling to AJAX");j.opts.useWebSocket=false;j.actionLogin.call(j)}else{console.error("Authentication error: ",r,p);j.display(c.text("authPin_errorServer"),true)}}}}}}}},function(){})};mpin.prototype.setIdentity=function(n,m,o,p){var k,j,l=this;if((typeof(n)==="undefined")||(!n)){k=""}else{this.identity=n;k=this.getDisplayName(this.identity)}j=document.getElementById("mpinUser");if(j){j.children[0].innerText=k;j.setAttribute("title",k)}if(!this.identity){this.renderSetupHome();return}if(m){if(this.ds.getIdentityToken(this.identity)==""){this.renderIdentityNotActive(k);return}this.enableNumberButtons(false);this.enableButton(false,"go");this.enableButton(false,"clear");this.enableButton(true,"toggle");this.requestPermit(n,function(q){l.enableNumberButtons(true)},function(r,q){if(q===404){l.renderIdentityNotActive(k);p()}else{l.display(c.text("pinpad_errorTimePermit")+" "+q,true);l.error("Error getting the time permit.",q);p()}})}};mpin.prototype.successSetup=function(k){var j=this;if(this.opts.successSetupURL){window.location=this.opts.successSetupURL}else{if(this.opts.onSuccessSetup){this.opts.onSuccessSetup(k,function(){j.renderSetupDone.call(j)})}else{this.renderSetupDone()}}};mpin.prototype.ajax=function(l,j){var k=new XMLHttpRequest();k.open("GET",l,true);k.send();k.onreadystatechange=function(){if(k.readyState===4&&k.status===200){j(JSON.parse(k.responseText))}else{if(k.readyState===4&&!navigator.onLine){j({error:500})}}}};mpin.prototype.ajaxPost=function(l,m,j){var k=new XMLHttpRequest();k.onreadystatechange=function(){if(k.readyState===4&&k.status===200){if(k.responseText==""){j(true)}}else{if(k.readyState===4){j(false)}}};k.open("Post",l,true);k.send(JSON.stringify(m))};mpin.prototype.requestPermit=function(k,l,m){var j=this;requestTimePermit(j.certivoxPermitsURL(),j.dtaPermitsURL(),j.opts.authenticateHeaders,j.ds.getIdentityPermitCache(this.identity),this.certivoxPermitsStorageURL(),function(p,o,n){j.ds.setIdentityPermit(j.identity,p);j.ds.setIdentityPermitCache(mpin.identity,o);j.currentDate=n||util.today();j.ds.save();j.gotPermit(p);l(p)},function(o,n){m(o,n)})};mpin.prototype.deleteIdentity=function(l){var m="",j=this;this.ds.deleteIdentity(l);for(var k in this.ds.getAccounts()){m=k;break}if(m){this.setIdentity(m,true,function(){},function(){return false});this.ds.setDefaultIdentity(m);this.renderAccountsPanel()}else{this.setIdentity(m,false);this.ds.setDefaultIdentity("");this.identity="";this.renderSetupHome()}return false};mpin.prototype.dataSource=function(){var k={},j=this;this.ds||(this.ds={});if(typeof(localStorage.mpin)==="undefined"){localStorage.setItem("mpin",JSON.stringify({defaultIdentity:"",version:"0.3",accounts:{}}))}k.mpin=JSON.parse(localStorage.getItem("mpin"));k.addIdentity=function(m,l,n){if(!k.mpin.accounts[m]){k.mpin.accounts[m]={MPinPermit:"",token:""}}k.setIdentityToken(m,l);if(n){k.setIdentityPermit(m,n)}};k.setIdentityToken=function(l,m){k.mpin.accounts[l]["token"]=m;k.save()};k.setIdentityPermit=function(l,m){k.mpin.accounts[l]["MPinPermit"]=m;k.save()};k.getIdentityPermit=function(l){if(!l){l=k.getDefaultIdentity()}return k.mpin.accounts[l]["MPinPermit"]};k.setIdentityPermitCache=function(m,l){if(!m){m=k.getDefaultIdentity()}k.mpin.accounts[m]["timePermitCache"]=l;k.save()};k.getIdentityPermitCache=function(l){if(!l){l=k.getDefaultIdentity()}return k.mpin.accounts[l]["timePermitCache"]||{}};k.getIdentityToken=function(l){if(!l){l=k.getDefaultIdentity()}return k.mpin.accounts[l]["token"]};k.getDefaultIdentity=function(l){return k.mpin.defaultIdentity};k.setDefaultIdentity=function(l){k.mpin.defaultIdentity=l;k.save()};k.deleteOldIdentity=function(o){var l=j.getDisplayName(o);for(var m in this.getAccounts()){if(m!==o){var n=j.getDisplayName(m);if(n===l){k.deleteIdentity(m)}}}};k.deleteIdentity=function(l){delete k.mpin.accounts[l];k.save()};k.save=function(){localStorage.setItem("mpin",JSON.stringify(k.mpin))};k.getAccounts=function(){return k.mpin.accounts};k.setIdentityData=function(n,m){for(var l in m){k.mpin.accounts[n][l]=m[l]}k.save()};k.setDeviceName=function(l){k.mpin.deviceName=l;k.save()};k.getDeviceName=function(){var l;l=k.mpin.deviceName;if(!l){return false}return l};k.getIdentityData=function(m,l){return k.mpin.accounts[m][l]};return k};mpin.prototype.successLogin=function(k,o){var l={},j=this,m;m=j.ds.getAccounts();m=Object.keys(m).length;l.mp_action_home=function(p){if(m===0){j.renderSetupHome()}else{if(m===1){j.renderAccessNumber()}else{if(m>1){j.renderAccessNumber(true)}}}};l.mp_action_logout=function(p){var q=this;if(k.logoutURL){j.ajaxPost(k.logoutURL,k.logoutData,function(r){if(r){j.renderAccessNumber.call(j)}else{q.innerHTML='<span class="btnLabel" id="btnLabelText" style="color: red;">Sign out was unsuccessful !</span>';setTimeout(function(){j.renderAccessNumber.call(j)},2000)}})}else{j.renderAccessNumber.call(j)}};this.render("success-login",l,{email:j.getDisplayName(o)});if(k.logoutURL===""){var n=document.getElementById("btnLabelText");n.innerText=c.text("start_over")}};mpin.prototype.certivoxClientSecretURL=function(j){return this.opts.certivoxURL+"clientSecret?"+j};mpin.prototype.certivoxPermitsURL=function(){var j=mpinAuth.sha256_hex(this.identity);return this.opts.certivoxURL+"timePermit?app_id="+this.opts.appID+"&mobile=0&hash_mpin_id="+j};mpin.prototype.dtaPermitsURL=function(){var j=this.identity;return this.opts.timePermitsURL+"/"+j};mpin.prototype.certivoxPermitsStorageURL=function(){var j=this;return function(k,l){if((k)&&(j.opts.timePermitsStorageURL)&&(l)){return j.opts.timePermitsStorageURL+"/"+j.opts.appID+"/"+k+"/"+l}else{return null}}};mpin.prototype.gotPermit=function(j){if(this.opts.onGetPermit){this.opts.onGetPermit(j)}};mpin.prototype.checkAccessNumberValidity=function(o,m){if(!m){m=1}var r=parseInt(o.slice(0,o.length-m),10);var j=parseInt(o.slice(o.length-m,o.length),10);var q=99991;var l=11;var k=((r*l)%q)%Math.pow(10,m);return(k==j)};mpin.prototype.checkAccessNumberValidity2=function(j,m){var p,n,q,s,t,r,l=11,o=0;t=j.toString();t=t.substring(0,j.toString().length-1);s=m+1;o=0;r=t.length;for(var k=0;k<r;k++){q=parseInt(t[k]);o+=(q*s);s-=1}n=(l-(o%l))%l;n=(n===10)?0:n;p=j.substr(-1);p=parseInt(p);return(p===n)};function g(n){if(!n||n.length%2!=0){return""}n=n.toLowerCase();var o="0123456789abcdef";var k="";for(var m=0;m<n.length;){var l=o.indexOf(n.charAt(m++));var j=o.indexOf(n.charAt(m++));if(l<0||j<0){return""}k+=String.fromCharCode(l*16+j)}return k}h=function(k,l){var j=document.createElement("script");j.type="text/javascript";j.src=k;if(j.readyState){j.onreadystatechange=l}else{j.onload=l}document.getElementsByTagName("head")[0].appendChild(j)};function f(j,m){var l;if(typeof(j)==="string"){l=document.getElementById(j)}else{l=j}if(l.className){var k=l.className.split(/\s+/g);if(k.indexOf(m)<0){l.className+=" "+m}}else{l.className=m}}function e(j,m){var l;if(typeof(j)=="string"){l=document.getElementById(j)}else{l=j}var k=l.className.split(/\s+/g);return(k.indexOf(m)>=0)}function i(j,m){var l;if(typeof(j)=="string"){l=document.getElementById(j)}else{l=j}if((l)&&(l.className)){var k=l.className.split(/\s+/g);k.splice(k.indexOf(m),1);l.className=k.join(" ")}}mpin.lang={};mpin.lang.en={pinpad_initializing:"Initializing...",pinpad_errorTimePermit:"ERROR GETTING PERMIT:",home_alt_mobileOptions:"Mobile Options",home_button_authenticateMobile_noTrust:"Sign in with Smartphone <br> (This is a PUBLIC device which I DO NOT trust)",home_button_authenticateMobile_trust:"Sign in with Browser <br> (This is a PERSONAL device which I DO trust)",home_button_authenticateMobile_intro:"First let's establish trust to choose the best way for you to access this service:",home_button_authenticateMobile_description:"Get your Mobile Access Number to use with your M-Pin Mobile App to securely authenticate yourself to this service.",home_button_getMobile:"Get <br/>M-Pin Mobile App",home_button_getMobile_description:"Install the free M-Pin Mobile App on your Smartphone now!  This will enable you to securely authenticate yourself to this service.",home_button_authenticateBrowser:"Authenticate <br/>with this Browser",home_button_authenticateBrowser_description:"Enter your M-PIN to securely authenticate yourself to this service.",home_button_setupBrowser:"Add an <br/>Identity to this Browser",home_button_setupBrowser_description:"Add your Identity to this web browser to securely authenticate yourself to this service using this machine.",mobileGet_header:"GET M-PIN MOBILE APP",mobileGet_text1:"Scan this QR code",mobileGet_text2:"or open this URL on your mobile:",mobileGet_button_back:"Back",mobileAuth_header:"AUTHENTICATE WITH YOUR M-PIN",mobileAuth_seconds:"seconds",mobileAuth_text1:"Your Access Number is:",mobileAuth_text2:"Note: Use this number in the next",mobileAuth_text3:"with your M-Pin Mobile App.",mobileAuth_text4:"Warning: Navigating away from this page will interrupt the authentication process and you will need to start again to authenticate successfully.",otp_signin_header:"Sign in with One-Time Password",otp_text1:"Your One-Time Password is:",otp_text2:"Note: The password is only valid for "+mpin.cfg.expireOtpSeconds+" seconds before it expires.",otp_seconds:"Remaining:",otp_expired_header:"Your One-Time Password has expired.",otp_expired_button_home:"Login again to get a new OTP",setup_header:"Add an identity",setup_text1:"Email address:",setup_text2:"Your email address will be used as your identity when M-Pin authenticates you to this service.",setup_text3:"Enter your email",setup_error_unathorized:"{0} has not been registered in the system.",setup_error_server:"Cannot process the request. Please try again later.",setup_error_signupexpired:"Your signup request has been expired. Please try again.",setup_button_setup:"Setup M-Pin",setupPin_header:"Create your M-Pin with {0} digits",setupPin_initializing:"Initializing...",setupPin_pleasewait:"Please wait...",setupPin_button_clear:"Clear",setupPin_button_done:"Setup Pin",setupPin_errorSetupPin:"ERROR SETTING PIN: {0}",setupDone_header:"Congratulations!",edit_identity:"Edit Identity:",setupDone_text1:"Your M-Pin Identity:",setupDone_text2:"is set up successfully.",setupDone_text3:"",setupDone_button_go:"Sign in with this M-Pin",setupReady_header:"VERIFY YOUR IDENTITY",setupReady_text1:"We have sent you an email to",setupReady_text2:"Click the link in the email to confirm your identity and proceed",setupReady_text3:"We have just sent you an email, simply click the link to verify your identity.",setupReady_button_go:"I confirmed my email",setupReady_button_go_cont:"Setup your M-Pin now",setupReady_button_resend:"Resend confirmation email",setupReady_button_resend_cont:"Send it again",setupNotReady_header:"YOU MUST VERIFY <br/>YOUR IDENTITY",setupNotReady_text1:"Your identity",setupNotReady_text2:"has not been verified.",setupNotReady_text3:"You need to click the link in the email we sent you, and then choose <br/> 'Setup M-Pin'.",setupNotReady_check_info1:"Checking",setupNotReady_check_info2:"Identity not verified!",setupNotReady_resend_info1:"Sending email",setupNotReady_resend_info2:"Email sent!",setupNotReady_button_check:"Setup M-Pin",setupNotReady_button_resend:"Send the email again",setupNotReady_button_back:"Go to the identities list",authPin_header:"Enter your M-Pin",authPin_button_clear:"Clear",authPin_button_login:"Login",authPin_button_next:"Next",authPin_pleasewait:"Authenticating...",authPin_success:"Success!",authPin_errorInvalidPin:"Incorrect Pin!",authPin_errorInvalidAccessNumber:"Invalid access number!",authPin_errorNotAuthorized:"You are not authorized!",authPin_errorExpired:"The auth request expired!",authPin_errorServer:"Server error!",deactivated_header:"SECURITY ALERT",deactivated_text1:"has been de-activated and your M-Pin token has been revoked.",deactivated_text2:"To re-activate your identity, click on the blue button below to register again.",deactivated_button_register:"Register again",account_button_addnew:"Add a new identity to this list",account_button_delete:"Remove Identity",account_button_reactivate:"Reset PIN",account_button_backToList:"Back to identity list",account_button_cancel:"Cancel and go back",account_delete_question:"Are you sure you wish to remove this M-Pin Identity from this browser?",account_delete_button:"Yes, remove it",account_reactivate_question:"Are you sure you wish to reactivate this M-Pin Identity?",account_reactivate_button:"Yes, re-activate",noaccount_header:"No identities have been added to this browser!",noaccount_button_add:"Add a new identity",pinpad_placeholder_text:"Enter your pin",pinpad_placeholder_setup:"Setup your PIN",pinpad_placeholder_text2:"Enter access number",logout_text1:"YOU ARE NOW LOGGED IN",logout_button:"Logout",home_button_setupMobile:"Add an identity to this browser",mobile_splash_text:"INSTALL THE M-PIN MOBILE APP",mobile_add_home_ios:"Tap the icon to 'Add to homescreen'",help_text_1:"Simply choose a memorable <b>[4 digit]</b> PIN to assign to this identity by pressing the numbers in sequence followed by the 'Setup' button to setup your PIN for this identity",help_ok_btn:"Ok, Got it",help_more_btn:"I'm not sure, tell me more",logout_btn:"Sign out",success_header:"Success",success_text:"You are now signed in as:",accessdenied_header:"Access Denied",accessdenied_text:"Your M-Pin identity",accessdenied_text_cont:"has been removed from this device.",accessdenied_btn:"Register again",setup_btn_text:"Setup",setup_device_label:"Device name:",verify_pin:"Verifying PIN...",sign_in:"Sign In",clear:"Clear",setup:"Setup",start_over:"Start Over",embedded_header:"To function properly, M-Pin should be opened in Safari. To open it in Safari, do one  of the following:",embedded_p1:"1. If your QR Code Reader provides the capability to open the page in Safari, please use this option to do so.",embedded_p2:"2. Copy the URL from the address bar, open Safari, Paste the URL in its address bar and proceed according the on-screen instructions."};c.img=function(j){return d+j};c.text=function(j){return mpin.lang[c.language][j]};var a=function(){if(typeof(String.prototype.trim)==="undefined"){String.prototype.mpin_trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}}else{String.prototype.mpin_trim=String.prototype.trim}String.prototype.mpin_endsWith=function(j){return this.length>=j.length&&this.substr(this.length-j.length)==j};String.prototype.mpin_startsWith=function(j){return this.indexOf(j)==0};if(!String.prototype.mpin_format){String.prototype.mpin_format=function(){var j=arguments;return this.replace(/{(\d+)}/g,function(k,l){return typeof j[l]!="undefined"?j[l]:k})}}}})();